import{_ as X,r as h,a as F,K as le,n as Q,g as i,c as T,o as k,e,q as N,w as l,h as m,F as E,d as g,t as $,L as B,N as ie,E as I,v as Be,B as Fe,l as q,O as Ke,C as se,P as He,J as Je,T as Re,G as qe,X as Ge,U as Xe}from"./index-Cq749T7a.js";import{d as L,t as Qe}from"./index-DZNyvenB.js";import{f as Ye}from"./index-Cp9DYLzB.js";const Ze={class:"wechat-config"},el={class:"form-tip"},ll={class:"form-tip"},tl={class:"form-tip"},ol={__name:"WeChatConfig",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","test"],setup(M,{emit:D}){const A=M,x=D,U=h(!1),t=F({type:"robot",webhook_url:"",key:"",corp_id:"",agent_id:null,secret:"",to_user:"",to_party:"",to_tag:""});le(()=>A.modelValue,z=>{z&&typeof z=="object"&&Object.assign(t,{type:"robot",webhook_url:"",key:"",corp_id:"",agent_id:null,secret:"",to_user:"",to_party:"",to_tag:"",...z})},{immediate:!0});const a=()=>{x("update:modelValue",{...t})},f=()=>{t.type==="robot"?(t.corp_id="",t.agent_id=null,t.secret="",t.to_user="",t.to_party="",t.to_tag=""):(t.webhook_url="",t.key=""),a()},w=async()=>{U.value=!0;try{await x("test",{...t})}finally{U.value=!1}};return Q(()=>{a()}),(z,s)=>{const C=i("el-radio"),r=i("el-radio-group"),n=i("el-form-item"),y=i("el-input"),p=i("el-text"),_=i("el-input-number"),O=i("el-button");return k(),T("div",Ze,[e(n,{label:"推送类型",prop:"type"},{default:l(()=>[e(r,{modelValue:t.type,"onUpdate:modelValue":s[0]||(s[0]=v=>t.type=v),onChange:f},{default:l(()=>[e(C,{label:"robot"},{default:l(()=>s[9]||(s[9]=[m("群机器人")])),_:1,__:[9]}),e(C,{label:"app"},{default:l(()=>s[10]||(s[10]=[m("应用消息")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t.type==="robot"?(k(),T(E,{key:0},[e(n,{label:"Webhook地址",prop:"webhook_url"},{default:l(()=>[e(y,{modelValue:t.webhook_url,"onUpdate:modelValue":s[1]||(s[1]=v=>t.webhook_url=v),placeholder:"请输入群机器人Webhook地址",onInput:a},null,8,["modelValue"]),g("div",el,[e(p,{type:"info",size:"small"},{default:l(()=>s[11]||(s[11]=[m(" 在企业微信群中添加机器人，复制Webhook地址 ")])),_:1,__:[11]})])]),_:1}),e(n,{label:"Key",prop:"key"},{default:l(()=>[e(y,{modelValue:t.key,"onUpdate:modelValue":s[2]||(s[2]=v=>t.key=v),placeholder:"请输入机器人Key（可选）",onInput:a},null,8,["modelValue"]),g("div",ll,[e(p,{type:"info",size:"small"},{default:l(()=>s[12]||(s[12]=[m(" 从Webhook地址中提取的key参数 ")])),_:1,__:[12]})])]),_:1})],64)):N("",!0),t.type==="app"?(k(),T(E,{key:1},[e(n,{label:"企业ID",prop:"corp_id"},{default:l(()=>[e(y,{modelValue:t.corp_id,"onUpdate:modelValue":s[3]||(s[3]=v=>t.corp_id=v),placeholder:"请输入企业ID",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"应用ID",prop:"agent_id"},{default:l(()=>[e(_,{modelValue:t.agent_id,"onUpdate:modelValue":s[4]||(s[4]=v=>t.agent_id=v),placeholder:"请输入应用ID",style:{width:"100%"},onChange:a},null,8,["modelValue"])]),_:1}),e(n,{label:"应用Secret",prop:"secret"},{default:l(()=>[e(y,{modelValue:t.secret,"onUpdate:modelValue":s[5]||(s[5]=v=>t.secret=v),placeholder:"请输入应用Secret",type:"password","show-password":"",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"接收人",prop:"to_user"},{default:l(()=>[e(y,{modelValue:t.to_user,"onUpdate:modelValue":s[6]||(s[6]=v=>t.to_user=v),placeholder:"请输入接收人用户ID，多个用|分隔",onInput:a},null,8,["modelValue"]),g("div",tl,[e(p,{type:"info",size:"small"},{default:l(()=>s[13]||(s[13]=[m(" 用户ID，多个用|分隔，如：userid1|userid2 ")])),_:1,__:[13]})])]),_:1}),e(n,{label:"接收部门",prop:"to_party"},{default:l(()=>[e(y,{modelValue:t.to_party,"onUpdate:modelValue":s[7]||(s[7]=v=>t.to_party=v),placeholder:"请输入接收部门ID，多个用|分隔（可选）",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"接收标签",prop:"to_tag"},{default:l(()=>[e(y,{modelValue:t.to_tag,"onUpdate:modelValue":s[8]||(s[8]=v=>t.to_tag=v),placeholder:"请输入接收标签ID，多个用|分隔（可选）",onInput:a},null,8,["modelValue"])]),_:1})],64)):N("",!0),e(n,null,{default:l(()=>[e(O,{type:"primary",onClick:w,loading:U.value,icon:"Connection"},{default:l(()=>s[14]||(s[14]=[m(" 测试配置 ")])),_:1,__:[14]},8,["loading"])]),_:1})])}}},al=X(ol,[["__scopeId","data-v-68af9750"]]),nl={class:"dingtalk-config"},sl={class:"form-tip"},dl={class:"form-tip"},ul={class:"form-tip"},rl={class:"form-tip"},pl={__name:"DingTalkConfig",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","test"],setup(M,{emit:D}){const A=M,x=D,U=h(!1),t=F({type:"robot",webhook_url:"",secret:"",app_key:"",app_secret:"",agent_id:null,user_ids:"",dept_ids:"",to_all_user:!1});le(()=>A.modelValue,z=>{z&&typeof z=="object"&&Object.assign(t,{type:"robot",webhook_url:"",secret:"",app_key:"",app_secret:"",agent_id:null,user_ids:"",dept_ids:"",to_all_user:!1,...z})},{immediate:!0});const a=()=>{x("update:modelValue",{...t})},f=()=>{t.type==="robot"?(t.app_key="",t.app_secret="",t.agent_id=null,t.user_ids="",t.dept_ids="",t.to_all_user=!1):(t.webhook_url="",t.secret=""),a()},w=async()=>{U.value=!0;try{await x("test",{...t})}finally{U.value=!1}};return Q(()=>{a()}),(z,s)=>{const C=i("el-radio"),r=i("el-radio-group"),n=i("el-form-item"),y=i("el-input"),p=i("el-text"),_=i("el-input-number"),O=i("el-switch"),v=i("el-button");return k(),T("div",nl,[e(n,{label:"推送类型",prop:"type"},{default:l(()=>[e(r,{modelValue:t.type,"onUpdate:modelValue":s[0]||(s[0]=V=>t.type=V),onChange:f},{default:l(()=>[e(C,{label:"robot"},{default:l(()=>s[9]||(s[9]=[m("群机器人")])),_:1,__:[9]}),e(C,{label:"work"},{default:l(()=>s[10]||(s[10]=[m("工作通知")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t.type==="robot"?(k(),T(E,{key:0},[e(n,{label:"Webhook地址",prop:"webhook_url"},{default:l(()=>[e(y,{modelValue:t.webhook_url,"onUpdate:modelValue":s[1]||(s[1]=V=>t.webhook_url=V),placeholder:"请输入群机器人Webhook地址",onInput:a},null,8,["modelValue"]),g("div",sl,[e(p,{type:"info",size:"small"},{default:l(()=>s[11]||(s[11]=[m(" 在钉钉群中添加自定义机器人，复制Webhook地址 ")])),_:1,__:[11]})])]),_:1}),e(n,{label:"加签密钥",prop:"secret"},{default:l(()=>[e(y,{modelValue:t.secret,"onUpdate:modelValue":s[2]||(s[2]=V=>t.secret=V),placeholder:"请输入加签密钥（可选）",type:"password","show-password":"",onInput:a},null,8,["modelValue"]),g("div",dl,[e(p,{type:"info",size:"small"},{default:l(()=>s[12]||(s[12]=[m(" 如果设置了加签安全设置，请输入密钥 ")])),_:1,__:[12]})])]),_:1})],64)):N("",!0),t.type==="work"?(k(),T(E,{key:1},[e(n,{label:"AppKey",prop:"app_key"},{default:l(()=>[e(y,{modelValue:t.app_key,"onUpdate:modelValue":s[3]||(s[3]=V=>t.app_key=V),placeholder:"请输入应用AppKey",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"AppSecret",prop:"app_secret"},{default:l(()=>[e(y,{modelValue:t.app_secret,"onUpdate:modelValue":s[4]||(s[4]=V=>t.app_secret=V),placeholder:"请输入应用AppSecret",type:"password","show-password":"",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"AgentId",prop:"agent_id"},{default:l(()=>[e(_,{modelValue:t.agent_id,"onUpdate:modelValue":s[5]||(s[5]=V=>t.agent_id=V),placeholder:"请输入应用AgentId",style:{width:"100%"},onChange:a},null,8,["modelValue"])]),_:1}),e(n,{label:"接收用户",prop:"user_ids"},{default:l(()=>[e(y,{modelValue:t.user_ids,"onUpdate:modelValue":s[6]||(s[6]=V=>t.user_ids=V),placeholder:"请输入接收用户ID，多个用逗号分隔",onInput:a},null,8,["modelValue"]),g("div",ul,[e(p,{type:"info",size:"small"},{default:l(()=>s[13]||(s[13]=[m(" 用户ID，多个用逗号分隔，如：userid1,userid2 ")])),_:1,__:[13]})])]),_:1}),e(n,{label:"接收部门",prop:"dept_ids"},{default:l(()=>[e(y,{modelValue:t.dept_ids,"onUpdate:modelValue":s[7]||(s[7]=V=>t.dept_ids=V),placeholder:"请输入接收部门ID，多个用逗号分隔（可选）",onInput:a},null,8,["modelValue"])]),_:1}),e(n,{label:"发送全员",prop:"to_all_user"},{default:l(()=>[e(O,{modelValue:t.to_all_user,"onUpdate:modelValue":s[8]||(s[8]=V=>t.to_all_user=V),onChange:a},null,8,["modelValue"]),g("div",rl,[e(p,{type:"info",size:"small"},{default:l(()=>s[14]||(s[14]=[m(" 开启后将发送给企业全部用户 ")])),_:1,__:[14]})])]),_:1})],64)):N("",!0),e(n,null,{default:l(()=>[e(v,{type:"primary",onClick:w,loading:U.value,icon:"Connection"},{default:l(()=>s[15]||(s[15]=[m(" 测试配置 ")])),_:1,__:[15]},8,["loading"])]),_:1})])}}},il=X(pl,[["__scopeId","data-v-01c544ac"]]),ml={class:"email-config"},_l={class:"form-tip"},fl={class:"form-tip"},yl={class:"form-tip"},cl={class:"form-tip"},bl={class:"form-tip"},gl={class:"form-tip"},vl={class:"form-tip"},Vl={__name:"EmailConfig",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","test"],setup(M,{emit:D}){const A=M,x=D,U=h(!1),t=F({host:"",port:587,username:"",password:"",ssl:!0,from:"",from_name:"",to:[],cc:[],format:"mixed",subject:"",priority:3}),a=h(""),f=h("");le(()=>A.modelValue,r=>{r&&typeof r=="object"&&(Object.assign(t,{host:"",port:587,username:"",password:"",ssl:!0,from:"",from_name:"",to:[],cc:[],format:"mixed",subject:"",priority:3,...r}),a.value=Array.isArray(t.to)?t.to.join(","):t.to||"",f.value=Array.isArray(t.cc)?t.cc.join(","):t.cc||"")},{immediate:!0});const w=()=>{x("update:modelValue",{...t})},z=r=>{a.value=r,t.to=r?r.split(",").map(n=>n.trim()).filter(n=>n):[],w()},s=r=>{f.value=r,t.cc=r?r.split(",").map(n=>n.trim()).filter(n=>n):[],w()},C=async()=>{U.value=!0;try{await x("test",{...t})}finally{U.value=!1}};return Q(()=>{w()}),(r,n)=>{const y=i("el-input"),p=i("el-text"),_=i("el-form-item"),O=i("el-input-number"),v=i("el-switch"),V=i("el-radio"),R=i("el-radio-group"),c=i("el-option"),W=i("el-select"),te=i("el-button");return k(),T("div",ml,[e(_,{label:"SMTP服务器",prop:"host"},{default:l(()=>[e(y,{modelValue:t.host,"onUpdate:modelValue":n[0]||(n[0]=b=>t.host=b),placeholder:"请输入SMTP服务器地址",onInput:w},null,8,["modelValue"]),g("div",_l,[e(p,{type:"info",size:"small"},{default:l(()=>n[12]||(n[12]=[m(" 如：smtp.gmail.com, smtp.qq.com, smtp.126.com ")])),_:1,__:[12]})])]),_:1}),e(_,{label:"端口",prop:"port"},{default:l(()=>[e(O,{modelValue:t.port,"onUpdate:modelValue":n[1]||(n[1]=b=>t.port=b),placeholder:"请输入SMTP端口",min:1,max:65535,style:{width:"100%"},onChange:w},null,8,["modelValue"]),g("div",fl,[e(p,{type:"info",size:"small"},{default:l(()=>n[13]||(n[13]=[m(" SSL: 465, TLS: 587, 无加密: 25 ")])),_:1,__:[13]})])]),_:1}),e(_,{label:"用户名",prop:"username"},{default:l(()=>[e(y,{modelValue:t.username,"onUpdate:modelValue":n[2]||(n[2]=b=>t.username=b),placeholder:"请输入SMTP用户名",onInput:w},null,8,["modelValue"])]),_:1}),e(_,{label:"密码",prop:"password"},{default:l(()=>[e(y,{modelValue:t.password,"onUpdate:modelValue":n[3]||(n[3]=b=>t.password=b),placeholder:"请输入SMTP密码",type:"password","show-password":"",onInput:w},null,8,["modelValue"]),g("div",yl,[e(p,{type:"info",size:"small"},{default:l(()=>n[14]||(n[14]=[m(" Gmail等需要使用应用专用密码 ")])),_:1,__:[14]})])]),_:1}),e(_,{label:"SSL加密",prop:"ssl"},{default:l(()=>[e(v,{modelValue:t.ssl,"onUpdate:modelValue":n[4]||(n[4]=b=>t.ssl=b),onChange:w},null,8,["modelValue"]),g("div",cl,[e(p,{type:"info",size:"small"},{default:l(()=>n[15]||(n[15]=[m(" 开启后使用SSL/TLS加密连接 ")])),_:1,__:[15]})])]),_:1}),e(_,{label:"发件人",prop:"from"},{default:l(()=>[e(y,{modelValue:t.from,"onUpdate:modelValue":n[5]||(n[5]=b=>t.from=b),placeholder:"请输入发件人邮箱地址",onInput:w},null,8,["modelValue"])]),_:1}),e(_,{label:"发件人姓名",prop:"from_name"},{default:l(()=>[e(y,{modelValue:t.from_name,"onUpdate:modelValue":n[6]||(n[6]=b=>t.from_name=b),placeholder:"请输入发件人姓名（可选）",onInput:w},null,8,["modelValue"])]),_:1}),e(_,{label:"收件人",prop:"to"},{default:l(()=>[e(y,{modelValue:a.value,"onUpdate:modelValue":n[7]||(n[7]=b=>a.value=b),placeholder:"请输入收件人邮箱地址，多个用逗号分隔",onInput:z},null,8,["modelValue"]),g("div",bl,[e(p,{type:"info",size:"small"},{default:l(()=>n[16]||(n[16]=[m(" 多个收件人用逗号分隔，如：user1@example.com,user2@example.com ")])),_:1,__:[16]})])]),_:1}),e(_,{label:"抄送",prop:"cc"},{default:l(()=>[e(y,{modelValue:f.value,"onUpdate:modelValue":n[8]||(n[8]=b=>f.value=b),placeholder:"请输入抄送邮箱地址，多个用逗号分隔（可选）",onInput:s},null,8,["modelValue"])]),_:1}),e(_,{label:"邮件格式",prop:"format"},{default:l(()=>[e(R,{modelValue:t.format,"onUpdate:modelValue":n[9]||(n[9]=b=>t.format=b),onChange:w},{default:l(()=>[e(V,{label:"text"},{default:l(()=>n[17]||(n[17]=[m("纯文本")])),_:1,__:[17]}),e(V,{label:"html"},{default:l(()=>n[18]||(n[18]=[m("HTML")])),_:1,__:[18]}),e(V,{label:"mixed"},{default:l(()=>n[19]||(n[19]=[m("混合格式")])),_:1,__:[19]})]),_:1},8,["modelValue"]),g("div",gl,[e(p,{type:"info",size:"small"},{default:l(()=>n[20]||(n[20]=[m(" 混合格式推荐使用，兼容性最好 ")])),_:1,__:[20]})])]),_:1}),e(_,{label:"邮件主题",prop:"subject"},{default:l(()=>[e(y,{modelValue:t.subject,"onUpdate:modelValue":n[10]||(n[10]=b=>t.subject=b),placeholder:"请输入邮件主题模板（可选）",onInput:w},null,8,["modelValue"]),g("div",vl,[e(p,{type:"info",size:"small"},{default:l(()=>[m(" 支持变量："+$(r.title)+"、"+$(r.date)+"、"+$(r.time),1)]),_:1})])]),_:1}),e(_,{label:"邮件优先级",prop:"priority"},{default:l(()=>[e(W,{modelValue:t.priority,"onUpdate:modelValue":n[11]||(n[11]=b=>t.priority=b),placeholder:"选择邮件优先级",onChange:w},{default:l(()=>[e(c,{value:1,label:"高优先级"}),e(c,{value:3,label:"普通优先级"}),e(c,{value:5,label:"低优先级"})]),_:1},8,["modelValue"])]),_:1}),e(_,null,{default:l(()=>[e(te,{type:"primary",onClick:C,loading:U.value,icon:"Connection"},{default:l(()=>n[21]||(n[21]=[m(" 测试配置 ")])),_:1,__:[21]},8,["loading"])]),_:1})])}}},wl=X(Vl,[["__scopeId","data-v-8dba71eb"]]),kl={class:"webhook-config"},Cl={class:"form-tip"},hl={class:"form-tip"},Ul={class:"form-tip"},Tl={class:"form-tip"},Il={class:"form-tip"},xl={class:"form-tip"},Sl={__name:"WebhookConfig",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","test"],setup(M,{emit:D}){const A=M,x=D,U=h(!1),t=h(""),a=F({url:"",method:"POST",content_type:"application/json",auth_type:"none",username:"",password:"",token:"",api_key_name:"",api_key_value:"",headers:{},template:"",timeout:10,verify_ssl:!0});le(()=>A.modelValue,C=>{if(C&&typeof C=="object"){Object.assign(a,{url:"",method:"POST",content_type:"application/json",auth_type:"none",username:"",password:"",token:"",api_key_name:"",api_key_value:"",headers:{},template:"",timeout:10,verify_ssl:!0,...C});try{t.value=JSON.stringify(a.headers||{},null,2)}catch{t.value=""}}},{immediate:!0});const f=()=>{x("update:modelValue",{...a})},w=()=>{a.auth_type==="none"?(a.username="",a.password="",a.token="",a.api_key_name="",a.api_key_value=""):a.auth_type==="basic"?(a.token="",a.api_key_name="",a.api_key_value=""):a.auth_type==="bearer"?(a.username="",a.password="",a.api_key_name="",a.api_key_value=""):a.auth_type==="apikey"&&(a.username="",a.password="",a.token=""),f()},z=C=>{t.value=C;try{a.headers=C?JSON.parse(C):{}}catch{a.headers={}}f()},s=async()=>{U.value=!0;try{await x("test",{...a})}finally{U.value=!1}};return Q(()=>{f()}),(C,r)=>{const n=i("el-input"),y=i("el-text"),p=i("el-form-item"),_=i("el-option"),O=i("el-select"),v=i("el-input-number"),V=i("el-switch"),R=i("el-button");return k(),T("div",kl,[e(p,{label:"Webhook地址",prop:"url"},{default:l(()=>[e(n,{modelValue:a.url,"onUpdate:modelValue":r[0]||(r[0]=c=>a.url=c),placeholder:"请输入Webhook URL地址",onInput:f},null,8,["modelValue"]),g("div",Cl,[e(y,{type:"info",size:"small"},{default:l(()=>r[13]||(r[13]=[m(" 支持HTTP/HTTPS协议，如：https://api.example.com/webhook ")])),_:1,__:[13]})])]),_:1}),e(p,{label:"请求方法",prop:"method"},{default:l(()=>[e(O,{modelValue:a.method,"onUpdate:modelValue":r[1]||(r[1]=c=>a.method=c),placeholder:"选择请求方法",onChange:f},{default:l(()=>[e(_,{value:"GET",label:"GET"}),e(_,{value:"POST",label:"POST"}),e(_,{value:"PUT",label:"PUT"}),e(_,{value:"PATCH",label:"PATCH"}),e(_,{value:"DELETE",label:"DELETE"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"数据格式",prop:"content_type"},{default:l(()=>[e(O,{modelValue:a.content_type,"onUpdate:modelValue":r[2]||(r[2]=c=>a.content_type=c),placeholder:"选择数据格式",onChange:f},{default:l(()=>[e(_,{value:"application/json",label:"JSON"}),e(_,{value:"application/x-www-form-urlencoded",label:"表单格式"}),e(_,{value:"text/plain",label:"纯文本"}),e(_,{value:"text/xml",label:"XML"}),e(_,{value:"application/xml",label:"Application XML"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"认证方式",prop:"auth_type"},{default:l(()=>[e(O,{modelValue:a.auth_type,"onUpdate:modelValue":r[3]||(r[3]=c=>a.auth_type=c),placeholder:"选择认证方式",onChange:w},{default:l(()=>[e(_,{value:"none",label:"无认证"}),e(_,{value:"basic",label:"Basic认证"}),e(_,{value:"bearer",label:"Bearer Token"}),e(_,{value:"apikey",label:"API Key"})]),_:1},8,["modelValue"])]),_:1}),a.auth_type==="basic"?(k(),T(E,{key:0},[e(p,{label:"用户名",prop:"username"},{default:l(()=>[e(n,{modelValue:a.username,"onUpdate:modelValue":r[4]||(r[4]=c=>a.username=c),placeholder:"请输入用户名",onInput:f},null,8,["modelValue"])]),_:1}),e(p,{label:"密码",prop:"password"},{default:l(()=>[e(n,{modelValue:a.password,"onUpdate:modelValue":r[5]||(r[5]=c=>a.password=c),placeholder:"请输入密码",type:"password","show-password":"",onInput:f},null,8,["modelValue"])]),_:1})],64)):N("",!0),a.auth_type==="bearer"?(k(),B(p,{key:1,label:"Token",prop:"token"},{default:l(()=>[e(n,{modelValue:a.token,"onUpdate:modelValue":r[6]||(r[6]=c=>a.token=c),placeholder:"请输入Bearer Token",type:"password","show-password":"",onInput:f},null,8,["modelValue"])]),_:1})):N("",!0),a.auth_type==="apikey"?(k(),T(E,{key:2},[e(p,{label:"API Key名称",prop:"api_key_name"},{default:l(()=>[e(n,{modelValue:a.api_key_name,"onUpdate:modelValue":r[7]||(r[7]=c=>a.api_key_name=c),placeholder:"请输入API Key名称",onInput:f},null,8,["modelValue"]),g("div",hl,[e(y,{type:"info",size:"small"},{default:l(()=>r[14]||(r[14]=[m(" Header名称，如：X-API-Key、Authorization ")])),_:1,__:[14]})])]),_:1}),e(p,{label:"API Key值",prop:"api_key_value"},{default:l(()=>[e(n,{modelValue:a.api_key_value,"onUpdate:modelValue":r[8]||(r[8]=c=>a.api_key_value=c),placeholder:"请输入API Key值",type:"password","show-password":"",onInput:f},null,8,["modelValue"])]),_:1})],64)):N("",!0),e(p,{label:"自定义Headers",prop:"headers"},{default:l(()=>[e(n,{modelValue:t.value,"onUpdate:modelValue":r[9]||(r[9]=c=>t.value=c),type:"textarea",placeholder:"请输入自定义HTTP头部（JSON格式，可选）",rows:3,onInput:z},null,8,["modelValue"]),g("div",Ul,[e(y,{type:"info",size:"small"},{default:l(()=>r[15]||(r[15]=[m(' JSON格式，如：{"Content-Type": "application/json", "User-Agent": "MyApp"} ')])),_:1,__:[15]})])]),_:1}),e(p,{label:"消息模板",prop:"template"},{default:l(()=>[e(n,{modelValue:a.template,"onUpdate:modelValue":r[10]||(r[10]=c=>a.template=c),type:"textarea",placeholder:"请输入消息模板（可选）",rows:4,onInput:f},null,8,["modelValue"]),g("div",Tl,[e(y,{type:"info",size:"small"},{default:l(()=>[m(" 支持变量："+$(C.title)+"、"+$(C.content)+"、"+$(C.timestamp),1)]),_:1})])]),_:1}),e(p,{label:"超时时间",prop:"timeout"},{default:l(()=>[e(v,{modelValue:a.timeout,"onUpdate:modelValue":r[11]||(r[11]=c=>a.timeout=c),placeholder:"请求超时时间（秒）",min:1,max:300,style:{width:"100%"},onChange:f},null,8,["modelValue"]),g("div",Il,[e(y,{type:"info",size:"small"},{default:l(()=>r[16]||(r[16]=[m(" 请求超时时间，单位秒，建议5-30秒 ")])),_:1,__:[16]})])]),_:1}),e(p,{label:"验证SSL",prop:"verify_ssl"},{default:l(()=>[e(V,{modelValue:a.verify_ssl,"onUpdate:modelValue":r[12]||(r[12]=c=>a.verify_ssl=c),onChange:f},null,8,["modelValue"]),g("div",xl,[e(y,{type:"info",size:"small"},{default:l(()=>r[17]||(r[17]=[m(" 关闭后将跳过SSL证书验证（不推荐） ")])),_:1,__:[17]})])]),_:1}),e(p,null,{default:l(()=>[e(R,{type:"primary",onClick:s,loading:U.value,icon:"Connection"},{default:l(()=>r[18]||(r[18]=[m(" 测试配置 ")])),_:1,__:[18]},8,["loading"])]),_:1})])}}},zl=X(Sl,[["__scopeId","data-v-9b1fadd0"]]),$l={class:"channels"},jl={class:"page-header"},Al={class:"search-filter"},Ol={key:1,class:"text-gray-400"},Dl={class:"pagination-container"},Pl={style:{display:"flex","justify-content":"space-between","align-items":"center"}},El={style:{display:"flex","align-items":"center",gap:"8px"}},Ll={style:{color:"#999","font-size":"12px"}},Nl={style:{"font-size":"12px",color:"#999","margin-top":"4px"}},Ml={key:0},Wl={key:1},Bl={class:"dialog-footer"},Fl={class:"dialog-footer"},Kl={__name:"Channels",setup(M){const D=h([]),A=h(!1),x=h([]),U=h([]),t=h([]),a=F({name:"",type:"",status:""}),f=F({page:1,size:10,total:0}),w=h(!1),z=ie(()=>s.value?"编辑渠道":"添加渠道"),s=h(!1),C=h(!1),r=h(null),n=ie(()=>{if(!p.type)return U.value;const d=U.value.filter(j=>j.type===p.type),o=U.value.filter(j=>j.type!==p.type);return[...d,...o]}),y=h(),p=F({name:"",type:"",status:"active",description:"",template_id:""}),_=h({}),O={name:[{required:!0,message:"请输入渠道名称",trigger:"blur"}],type:[{required:!0,message:"请选择渠道类型",trigger:"change"}]},v=h(!1),V=h(!1),R=h(null),c=h(),W=F({title:"测试消息标题",content:"这是一条来自邮件告警平台的测试消息"}),te={title:[{required:!0,message:"请输入消息标题",trigger:"blur"}],content:[{required:!0,message:"请输入消息内容",trigger:"blur"}]},b=async()=>{A.value=!0;try{const d={page:f.page,size:f.size,...a},o=await L.list(d);D.value=o.data.channels||[],f.total=o.data.total||0}catch{I.error("获取渠道列表失败")}finally{A.value=!1}},me=async()=>{try{const d=await L.getTypes();x.value=d.data||[]}catch(d){console.error("获取渠道类型失败:",d),x.value=["wechat","dingtalk","email","webhook"]}},_e=async()=>{try{const d=await Qe.list();U.value=d.data.list||[],console.log("获取到的模版列表:",U.value)}catch(d){console.error("获取模版列表失败:",d)}},oe=()=>{f.page=1,b()},fe=()=>{Object.assign(a,{name:"",type:"",status:""}),f.page=1,b()},ye=({column:d,prop:o,order:j})=>{console.log("排序变化:",{column:d,prop:o,order:j})},ce=d=>{f.size=d,f.page=1,b()},be=d=>{f.page=d,b()},ge=()=>{s.value=!1,r.value=null,de(),w.value=!0},ve=d=>{s.value=!0,r.value=d,Object.assign(p,{name:d.name,type:d.type,status:d.status,description:d.description,template_id:d.template_id||""});try{_.value=JSON.parse(d.config||"{}")}catch(o){console.error("解析渠道配置失败:",o),_.value={}}w.value=!0},Ve=async(d,o)=>{switch(d){case"send":he(o);break;case"duplicate":await we(o);break;case"delete":await ke(o);break}},we=async d=>{try{const o={name:`${d.name} - 副本`,type:d.type,status:"inactive",description:`${d.description||""} (复制自 ${d.name})`,template_id:d.template_id,config:d.config};await L.create(o),I.success("复制渠道成功"),b()}catch(o){console.error("复制渠道失败:",o),I.error("复制渠道失败")}},ke=async d=>{try{await Xe.confirm(`确定要删除渠道 "${d.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await L.delete(d.id),I.success("删除成功"),b()}catch(o){o!=="cancel"&&I.error("删除失败")}},Ce=async d=>{t.value.push(d.id);try{await L.test(d.id),I.success("测试成功"),b()}catch{I.error("测试失败")}finally{t.value=t.value.filter(o=>o!==d.id)}},he=d=>{R.value=d,v.value=!0},Ue=async()=>{if(c.value)try{await c.value.validate(),V.value=!0,await L.send(R.value.id,W),I.success("发送成功"),v.value=!1}catch(d){d!==!1&&I.error("发送失败")}finally{V.value=!1}},Te=async()=>{if(y.value)try{await y.value.validate(),C.value=!0;const d={...p,config:JSON.stringify(_.value),template_id:p.template_id||null};s.value?(await L.update(r.value.id,d),I.success("更新成功")):(await L.create(d),I.success("创建成功")),w.value=!1,b()}catch(d){d!==!1&&I.error(s.value?"更新失败":"创建失败")}finally{C.value=!1}},Ie=d=>{_.value={}},xe=async d=>{var o,j;if(!p.type){I.error("请先选择渠道类型");return}if(!d||Object.keys(d).length===0){I.error("请填写渠道配置信息");return}try{console.log("测试配置:",{type:p.type,config:JSON.stringify(d)}),I.info("正在测试配置，请稍候..."),await L.test({type:p.type,config:JSON.stringify(d)}),I.success("配置测试成功")}catch(S){console.error("配置测试失败:",S);let P="配置测试失败";(j=(o=S.response)==null?void 0:o.data)!=null&&j.error?P+=": "+S.response.data.error:S.message&&(S.code==="ECONNABORTED"?P="配置测试超时，请检查网络连接或联系管理员":P+=": "+S.message),I.error(P)}},Se=()=>{de()},de=()=>{Object.assign(p,{name:"",type:"",status:"active",description:"",template_id:""}),_.value={},y.value&&y.value.clearValidate()},K=d=>({wechat:"企业微信",dingtalk:"钉钉",email:"邮件",webhook:"Webhook"})[d]||d,ze=d=>({wechat:"success",dingtalk:"primary",email:"warning",webhook:"info"})[d]||"info",$e=d=>({wechat:al,dingtalk:il,email:wl,webhook:zl})[d]||"div";return Q(()=>{me(),_e(),b()}),(d,o)=>{const j=i("el-icon"),S=i("el-button"),P=i("el-input"),Y=i("el-col"),G=i("el-option"),Z=i("el-select"),je=i("el-row"),H=i("el-table-column"),ee=i("el-tag"),ae=i("el-dropdown-item"),Ae=i("el-dropdown-menu"),Oe=i("el-dropdown"),De=i("el-button-group"),Pe=i("el-table"),Ee=i("el-pagination"),Le=i("el-card"),J=i("el-form-item"),ue=i("el-radio"),Ne=i("el-radio-group"),Me=i("el-divider"),re=i("el-form"),pe=i("el-dialog"),We=Be("loading");return k(),T("div",$l,[e(Le,null,{header:l(()=>[g("div",jl,[o[18]||(o[18]=g("span",null,"通知渠道管理",-1)),e(S,{type:"primary",onClick:ge},{default:l(()=>[e(j,null,{default:l(()=>[e(q(qe))]),_:1}),o[17]||(o[17]=m(" 添加渠道 "))]),_:1,__:[17]})])]),default:l(()=>[g("div",Al,[e(je,{gutter:20},{default:l(()=>[e(Y,{span:8},{default:l(()=>[e(P,{modelValue:a.name,"onUpdate:modelValue":o[0]||(o[0]=u=>a.name=u),placeholder:"搜索渠道名称",onInput:oe,clearable:""},{prefix:l(()=>[e(j,null,{default:l(()=>[e(q(Ke))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Y,{span:6},{default:l(()=>[e(Z,{modelValue:a.type,"onUpdate:modelValue":o[1]||(o[1]=u=>a.type=u),placeholder:"选择渠道类型",onChange:oe,clearable:""},{default:l(()=>[(k(!0),T(E,null,se(x.value,u=>(k(),B(G,{key:u,label:K(u),value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(Y,{span:6},{default:l(()=>[e(Z,{modelValue:a.status,"onUpdate:modelValue":o[2]||(o[2]=u=>a.status=u),placeholder:"选择状态",onChange:oe,clearable:""},{default:l(()=>[e(G,{label:"激活",value:"active"}),e(G,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),e(Y,{span:4},{default:l(()=>[e(S,{onClick:fe,icon:q(He)},{default:l(()=>o[19]||(o[19]=[m("重置")])),_:1,__:[19]},8,["icon"])]),_:1})]),_:1})]),Fe((k(),B(Pe,{data:D.value,style:{width:"100%"},onSortChange:ye},{default:l(()=>[e(H,{prop:"name",label:"渠道名称",sortable:""}),e(H,{prop:"type",label:"类型",width:"120",sortable:""},{default:l(u=>[e(ee,{type:ze(u.row.type)},{default:l(()=>[m($(K(u.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(H,{prop:"description",label:"描述","show-overflow-tooltip":""}),e(H,{prop:"status",label:"状态",width:"100",sortable:""},{default:l(u=>[e(ee,{type:u.row.status==="active"?"success":"danger"},{default:l(()=>[m($(u.row.status==="active"?"激活":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(H,{prop:"test_result",label:"测试状态",width:"120"},{default:l(u=>[u.row.test_result?(k(),B(ee,{key:0,type:u.row.test_result.includes("成功")?"success":"danger",size:"small"},{default:l(()=>[m($(u.row.test_result.includes("成功")?"正常":"异常"),1)]),_:2},1032,["type"])):(k(),T("span",Ol,"未测试"))]),_:1}),e(H,{prop:"created_at",label:"创建时间",width:"180",sortable:""},{default:l(u=>[m($(q(Ye)(u.row.created_at)),1)]),_:1}),e(H,{label:"操作",width:"250",fixed:"right"},{default:l(u=>[e(De,null,{default:l(()=>[e(S,{type:"primary",size:"small",onClick:ne=>Ce(u.row),loading:t.value.includes(u.row.id),icon:t.value.includes(u.row.id)?"":"Connection"},{default:l(()=>o[20]||(o[20]=[m(" 测试 ")])),_:2,__:[20]},1032,["onClick","loading","icon"]),e(S,{type:"success",size:"small",onClick:ne=>ve(u.row),icon:q(Je)},{default:l(()=>o[21]||(o[21]=[m(" 编辑 ")])),_:2,__:[21]},1032,["onClick","icon"]),e(Oe,{onCommand:ne=>Ve(ne,u.row)},{dropdown:l(()=>[e(Ae,null,{default:l(()=>[e(ae,{command:"send"},{default:l(()=>o[23]||(o[23]=[m(" 发送测试 ")])),_:1,__:[23]}),e(ae,{command:"duplicate"},{default:l(()=>o[24]||(o[24]=[m(" 复制渠道 ")])),_:1,__:[24]}),e(ae,{command:"delete",class:"text-danger",divided:""},{default:l(()=>o[25]||(o[25]=[m(" 删除 ")])),_:1,__:[25]})]),_:1})]),default:l(()=>[e(S,{size:"small",type:"info"},{default:l(()=>[o[22]||(o[22]=m(" 更多")),e(j,{class:"el-icon--right"},{default:l(()=>[e(q(Re))]),_:1})]),_:1,__:[22]})]),_:2},1032,["onCommand"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[We,A.value]]),g("div",Dl,[e(Ee,{"current-page":f.page,"onUpdate:currentPage":o[3]||(o[3]=u=>f.page=u),"page-size":f.size,"onUpdate:pageSize":o[4]||(o[4]=u=>f.size=u),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:be},null,8,["current-page","page-size","total"])])]),_:1}),e(pe,{modelValue:w.value,"onUpdate:modelValue":o[12]||(o[12]=u=>w.value=u),title:z.value,width:"600px",onClose:Se},{footer:l(()=>[g("div",Bl,[e(S,{onClick:o[11]||(o[11]=u=>w.value=!1)},{default:l(()=>o[29]||(o[29]=[m("取消")])),_:1,__:[29]}),e(S,{type:"primary",onClick:Te,loading:C.value},{default:l(()=>[m($(s.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:l(()=>[e(re,{ref_key:"channelFormRef",ref:y,model:p,rules:O,"label-width":"100px"},{default:l(()=>[e(J,{label:"渠道名称",prop:"name"},{default:l(()=>[e(P,{modelValue:p.name,"onUpdate:modelValue":o[5]||(o[5]=u=>p.name=u),placeholder:"请输入渠道名称"},null,8,["modelValue"])]),_:1}),e(J,{label:"渠道类型",prop:"type"},{default:l(()=>[e(Z,{modelValue:p.type,"onUpdate:modelValue":o[6]||(o[6]=u=>p.type=u),placeholder:"请选择渠道类型",onChange:Ie},{default:l(()=>[(k(!0),T(E,null,se(x.value,u=>(k(),B(G,{key:u,label:K(u),value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(J,{label:"状态",prop:"status"},{default:l(()=>[e(Ne,{modelValue:p.status,"onUpdate:modelValue":o[7]||(o[7]=u=>p.status=u)},{default:l(()=>[e(ue,{label:"active"},{default:l(()=>o[26]||(o[26]=[m("激活")])),_:1,__:[26]}),e(ue,{label:"inactive"},{default:l(()=>o[27]||(o[27]=[m("停用")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),e(J,{label:"描述",prop:"description"},{default:l(()=>[e(P,{modelValue:p.description,"onUpdate:modelValue":o[8]||(o[8]=u=>p.description=u),type:"textarea",placeholder:"请输入渠道描述",rows:2},null,8,["modelValue"])]),_:1}),e(J,{label:"消息模版",prop:"template_id"},{default:l(()=>[e(Z,{modelValue:p.template_id,"onUpdate:modelValue":o[9]||(o[9]=u=>p.template_id=u),placeholder:"选择消息模版（不选择则使用默认模版）",clearable:"",filterable:"",style:{width:"100%"}},{default:l(()=>[(k(!0),T(E,null,se(n.value,u=>(k(),B(G,{key:u.id,label:`${u.name} (${K(u.type)})`,value:u.id},{default:l(()=>[g("div",Pl,[g("span",null,$(u.name),1),g("div",El,[u.is_default?(k(),B(ee,{key:0,size:"small",type:"success"},{default:l(()=>o[28]||(o[28]=[m(" 默认 ")])),_:1,__:[28]})):N("",!0),g("span",Ll,$(K(u.type)),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),g("div",Nl,[p.type?(k(),T("span",Ml,' 推荐选择"'+$(K(p.type))+'"类型的模版，不选择时将使用默认模版 ',1)):(k(),T("span",Wl," 请先选择渠道类型，然后选择对应的消息模版 "))])]),_:1}),p.type?(k(),T(E,{key:0},[e(Me,null,{default:l(()=>[m($(K(p.type))+"配置",1)]),_:1}),(k(),B(Ge($e(p.type)),{modelValue:_.value,"onUpdate:modelValue":o[10]||(o[10]=u=>_.value=u),type:p.type,onTest:xe},null,40,["modelValue","type"]))],64)):N("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(pe,{modelValue:v.value,"onUpdate:modelValue":o[16]||(o[16]=u=>v.value=u),title:"发送测试消息",width:"500px"},{footer:l(()=>[g("div",Fl,[e(S,{onClick:o[15]||(o[15]=u=>v.value=!1)},{default:l(()=>o[30]||(o[30]=[m("取消")])),_:1,__:[30]}),e(S,{type:"primary",onClick:Ue,loading:V.value},{default:l(()=>o[31]||(o[31]=[m(" 发送 ")])),_:1,__:[31]},8,["loading"])])]),default:l(()=>[e(re,{ref_key:"sendFormRef",ref:c,model:W,rules:te,"label-width":"80px"},{default:l(()=>[e(J,{label:"消息标题",prop:"title"},{default:l(()=>[e(P,{modelValue:W.title,"onUpdate:modelValue":o[13]||(o[13]=u=>W.title=u),placeholder:"请输入消息标题"},null,8,["modelValue"])]),_:1}),e(J,{label:"消息内容",prop:"content"},{default:l(()=>[e(P,{modelValue:W.content,"onUpdate:modelValue":o[14]||(o[14]=u=>W.content=u),type:"textarea",placeholder:"请输入消息内容",rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ql=X(Kl,[["__scopeId","data-v-82bf0d3a"]]);export{ql as default};
//# sourceMappingURL=Channels-4-QNK_Ph.js.map
