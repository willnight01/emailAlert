import{_ as H,u as J,r as p,N as h,a as K,n as O,c as Q,o as E,d as c,e as l,B as W,w as s,g as n,v as X,L as Y,E as _,h as i,l as F,G as Z,P as ee,t as D,U as le}from"./index-Cq749T7a.js";import{u as g}from"./index-DZNyvenB.js";const ae={class:"admin-container"},se={class:"content"},te={class:"toolbar"},oe={class:"dialog-footer"},re={__name:"Admin",setup(ne){const N=J(),x=p([]),b=p(!1),m=p(!1),w=p(!1),d=p(!1),f=p(),k=h(()=>N.username),T=h(()=>d.value?"编辑用户":"添加用户"),a=K({username:"",password:"",role:"user"}),$={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:4,max:50,message:"密码长度在 4 到 50 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},v=async()=>{var u,e;b.value=!0;try{const o=await g.list();x.value=o.data||[]}catch(o){_.error("加载用户列表失败："+(((e=(u=o.response)==null?void 0:u.data)==null?void 0:e.error)||o.message))}finally{b.value=!1}},q=()=>{d.value=!1,m.value=!0,C()},A=u=>{d.value=!0,m.value=!0,a.username=u.username,a.password="",a.role=u.role},C=()=>{f.value&&f.value.resetFields(),a.username="",a.password="",a.role="user"},M=async()=>{var e,o;if(!(!f.value||!await f.value.validate().catch(()=>!1))){w.value=!0;try{d.value?(await g.update(a.username,{username:a.username,password:a.password,role:a.role}),_.success("用户更新成功")):(await g.create({username:a.username,password:a.password,role:a.role}),_.success("用户创建成功")),m.value=!1,v()}catch(r){_.error((d.value?"更新":"创建")+"用户失败："+(((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.error)||r.message))}finally{w.value=!1}}},R=async u=>{var e,o;try{await le.confirm(`确定要删除用户 "${u}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(u),_.success("用户删除成功"),v()}catch(r){r!=="cancel"&&_.error("删除用户失败："+(((o=(e=r.response)==null?void 0:e.data)==null?void 0:o.error)||r.message))}};return O(()=>{v()}),(u,e)=>{const o=n("el-icon"),r=n("el-button"),y=n("el-table-column"),S=n("el-tag"),z=n("el-table"),U=n("el-input"),V=n("el-form-item"),B=n("el-option"),I=n("el-select"),P=n("el-form"),G=n("el-dialog"),L=X("loading");return E(),Q("div",ae,[e[10]||(e[10]=c("div",{class:"page-header"},[c("h1",null,"用户管理"),c("p",null,"管理系统用户账号")],-1)),c("div",se,[c("div",te,[l(r,{type:"primary",onClick:q},{default:s(()=>[l(o,null,{default:s(()=>[l(F(Z))]),_:1}),e[5]||(e[5]=i(" 添加用户 "))]),_:1,__:[5]}),l(r,{onClick:v},{default:s(()=>[l(o,null,{default:s(()=>[l(F(ee))]),_:1}),e[6]||(e[6]=i(" 刷新 "))]),_:1,__:[6]})]),W((E(),Y(z,{data:x.value,style:{width:"100%"},"empty-text":"暂无用户数据"},{default:s(()=>[l(y,{prop:"username",label:"用户名",width:"200"}),l(y,{prop:"role",label:"角色",width:"120"},{default:s(({row:t})=>[l(S,{type:t.role==="admin"?"danger":"primary"},{default:s(()=>[i(D(t.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"操作",width:"200"},{default:s(({row:t})=>[l(r,{type:"primary",size:"small",onClick:j=>A(t),disabled:t.username===k.value},{default:s(()=>e[7]||(e[7]=[i(" 编辑 ")])),_:2,__:[7]},1032,["onClick","disabled"]),l(r,{type:"danger",size:"small",onClick:j=>R(t.username),disabled:t.username===k.value},{default:s(()=>e[8]||(e[8]=[i(" 删除 ")])),_:2,__:[8]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[L,b.value]])]),l(G,{title:T.value,modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),width:"500px",onClose:C},{footer:s(()=>[c("span",oe,[l(r,{onClick:e[3]||(e[3]=t=>m.value=!1)},{default:s(()=>e[9]||(e[9]=[i("取消")])),_:1,__:[9]}),l(r,{type:"primary",onClick:M,loading:w.value},{default:s(()=>[i(D(d.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:s(()=>[l(P,{model:a,rules:$,ref_key:"userFormRef",ref:f,"label-width":"80px"},{default:s(()=>[l(V,{label:"用户名",prop:"username"},{default:s(()=>[l(U,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=t=>a.username=t),placeholder:"请输入用户名",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),l(V,{label:"密码",prop:"password"},{default:s(()=>[l(U,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=t=>a.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(V,{label:"角色",prop:"role"},{default:s(()=>[l(I,{modelValue:a.role,"onUpdate:modelValue":e[2]||(e[2]=t=>a.role=t),placeholder:"请选择角色",style:{width:"100%"}},{default:s(()=>[l(B,{label:"管理员",value:"admin"}),l(B,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},ie=H(re,[["__scopeId","data-v-ad926137"]]);export{ie as default};
//# sourceMappingURL=Admin-kDgI_FaK.js.map
