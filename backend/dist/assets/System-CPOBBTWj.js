import{s as C}from"./index-DZNyvenB.js";import{_ as me,r as m,n as pe,c as r,o as c,d as s,q as b,e as o,s as f,t as a,w as n,g,B as F,v as fe,F as E,C as L,E as G,h as i,D as ge}from"./index-Cq749T7a.js";const ye={class:"system-page"},he={key:0,class:"status-overview"},be={class:"overall-status"},we={class:"status-info"},xe={class:"system-metrics"},Ve={class:"metric-item"},ke={class:"metric-value"},Ce={class:"metric-item"},Te={class:"metric-value"},Se={class:"metric-item"},Re={class:"metric-value text-success"},$e={class:"status-card"},Me={class:"card-header"},De={class:"service-list"},Ue={class:"service-info"},Ge={class:"service-name"},Ie={class:"service-desc"},ze={class:"resource-card"},Be={class:"card-header"},Pe={key:0,class:"performance-info"},Fe={class:"resource-charts"},Ee={key:0,class:"cpu-chart-item"},Le={class:"cpu-cores-display"},Ne={class:"cpu-info"},He={class:"cpu-title"},qe={class:"cpu-value"},Ae={class:"cores-number"},je={class:"cores-unit"},Je={class:"cpu-description"},Ke={class:"chart-header"},Oe={class:"chart-title"},Qe={class:"chart-name"},We={class:"chart-value"},Xe={class:"circular-progress"},Ye={class:"progress-center"},Ze={class:"progress-percentage"},es={class:"progress-label"},ss={class:"metric-analysis"},ts={class:"analysis-text"},ls={class:"analysis-reference"},as={class:"business-stats"},os={class:"card-header"},ns={class:"stats-grid"},is={class:"stat-icon"},rs={class:"stat-content"},cs={class:"stat-value"},us={class:"stat-name"},ds={key:0,class:"stat-desc"},vs={class:"stat-trend"},_s={class:"cleanup-section"},ms={class:"card-header"},ps={class:"cleanup-info"},fs={class:"cleanup-stats"},gs={class:"stat-item"},ys={class:"stat-value"},hs={class:"stat-item"},bs={class:"stat-value"},ws={class:"cleanup-dialog"},xs={class:"cleanup-warning"},Vs={class:"cleanup-preview"},ks={class:"cleanup-time"},Cs={class:"cleanup-confirm"},Ts={class:"dialog-footer"},Ss={class:"cleanup-result"},Rs={class:"result-content"},$s={key:0},Ms={key:1},Ds={key:2,class:"error-message"},Us={class:"dialog-footer"},Gs={__name:"System",setup(Is){const w=m(!1),x=m(!1),T=m(!1),y=m(null),N=m([]),h=m([]),S=m([]),V=m(!1),R=m(!1),$=m(!1),v=m({dataType:"both",timeRange:"3months",confirmed:!1}),p=m({success:!1,deleted_rows:0,duration:0,error:""}),H=async()=>{var l,e,_,k,M,D,U;try{w.value=!0;const u=await C.health();if(u.code===200){y.value=u.data,N.value=u.data.services||[];const d=u.data.resources;d&&(h.value=[{name:"CPU核心数",value:((l=d.cpu)==null?void 0:l.cores)||0,unit:"个",percentage:Math.min((((e=d.cpu)==null?void 0:e.cores)||0)*10,100),type:"cpu"},{name:"内存使用",value:C.formatMemorySize(((_=d.memory)==null?void 0:_.alloc)||0),unit:"",percentage:Math.round(((k=d.memory)==null?void 0:k.usage_percent)||0),type:"memory",rawValue:((M=d.memory)==null?void 0:M.alloc)||0},{name:"Goroutine数",value:d.goroutines||0,unit:"个",percentage:Math.min((d.goroutines||0)*2,100),type:"goroutine",rawValue:d.goroutines||0},{name:"GC次数",value:((D=d.gc)==null?void 0:D.num_gc)||0,unit:"次",percentage:Math.min((((U=d.gc)==null?void 0:U.num_gc)||0)*5,100),type:"gc"}])}}catch(u){console.error("获取系统健康状态失败:",u),G.error("获取系统状态失败")}finally{w.value=!1}},I=async()=>{try{x.value=!0;const l=await C.stats();if(l.code===200){const e=l.data.business;e&&(S.value=[{name:"邮箱总数",value:e.total_mailboxes||0,desc:`活跃: ${e.active_mailboxes||0}`,active:e.active_mailboxes||0,total:e.total_mailboxes||0},{name:"告警规则",value:e.total_rules||0,desc:`活跃: ${e.active_rules||0}`,active:e.active_rules||0,total:e.total_rules||0},{name:"通知渠道",value:e.total_channels||0,desc:`活跃: ${e.active_channels||0}`,active:e.active_channels||0,total:e.total_channels||0},{name:"告警记录",value:e.total_alerts||0,desc:`今日: ${e.today_alerts||0}`,today:e.today_alerts||0,total:e.total_alerts||0},{name:"通知记录",value:e.total_notifications||0,desc:`今日: ${e.today_notifications||0}`,today:e.today_notifications||0,total:e.total_notifications||0}])}}catch(l){console.error("获取业务统计失败:",l),G.error("获取业务统计失败")}finally{x.value=!1}},Y=()=>{H()},Z=()=>{I()},ee=l=>l<50?"#52c41a":l<80?"#faad14":"#ff4d4f",z=l=>{switch(l.type){case"memory":return l.percentage<50?"excellent":l.percentage<80?"good":"warning";case"goroutine":return l.rawValue<50?"excellent":l.rawValue<100?"good":"warning";case"cpu":return"info";case"gc":return"info";default:return"info"}},q=l=>{const e=z(l);return{excellent:"优秀",good:"良好",warning:"需关注",info:"正常"}[e]||"正常"},se=l=>({CPU核心数:"处理能力",内存使用:"使用率",Goroutine数:"并发数",GC次数:"回收次数"})[l]||"指标",A=l=>{switch(l.type){case"cpu":return`${l.value}核心提供充足的并行处理能力`;case"memory":return l.percentage<50?"内存使用健康，运行状态良好":l.percentage<80?"内存使用适中，需要持续观察":"内存使用较高，建议检查内存泄漏";case"goroutine":return l.rawValue<50?"并发负载轻，系统运行流畅":l.rawValue<100?"并发负载适中，系统处理正常":"并发负载较高，建议优化并发控制";case"gc":return`垃圾回收${l.value}次，内存管理正常`;default:return"运行正常"}},te=l=>({CPU核心数:"参考: 核心数反映系统最大并行处理能力",内存使用:"参考: <50%优秀 | 50-80%良好 | >80%需关注",Goroutine数:"参考: <50优秀 | 50-100良好 | >100需关注",GC次数:"参考: 反映程序运行时间和内存分配模式"})[l]||"",j=l=>l.name==="告警记录"?l.today>0?"up":"stable":l.active>0?"up":"stable",le=l=>{const e=j(l);return{up:"el-icon-trend-charts",down:"el-icon-bottom",stable:"el-icon-minus"}[e]||"el-icon-minus"},J=l=>C.getStatusText(l),ae=l=>({healthy:"el-icon-success-filled",degraded:"el-icon-warning-filled",unhealthy:"el-icon-error-filled"})[l]||"el-icon-info-filled",oe=l=>({数据库连接:"el-icon-coin",邮件监控服务:"el-icon-message",通知服务:"el-icon-bell",缓存服务:"el-icon-files"})[l]||"el-icon-service",ne=l=>({邮箱总数:"el-icon-message-box",告警规则:"el-icon-warning",通知渠道:"el-icon-chat-line-square",告警记录:"el-icon-document",通知记录:"el-icon-bell"})[l]||"el-icon-data-line",ie=()=>({alerts:"告警历史数据",notifications:"通知历史数据",both:"告警和通知历史数据"})[v.value.dataType]||"未知数据",re=()=>({"1month":"1个月前的数据","3months":"3个月前的数据","6months":"6个月前的数据","1year":"1年前的数据","2years":"2年前的数据",all:"所有历史数据"})[v.value.timeRange]||"未知范围",ce=async()=>{$.value=!0;try{const l=await C.cleanup(v.value.dataType,v.value.timeRange);if(l.code===200)p.value={success:!0,deleted_rows:l.data.deleted_rows,duration:l.data.duration,error:""},G.success(`清理完成，删除了 ${l.data.deleted_rows} 条记录`),await I();else throw new Error(l.message||"清理失败")}catch(l){p.value={success:!1,deleted_rows:0,duration:0,error:l.message||"清理操作失败"},G.error("清理失败: "+l.message)}finally{$.value=!1,V.value=!1,R.value=!0}},ue=()=>{R.value=!1,v.value={dataType:"both",timeRange:"3months",confirmed:!1}},de=l=>{if(!l)return"0ms";const e=Math.round(l/1e6);return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`};return pe(()=>{H(),I()}),(l,e)=>{var O,Q,W,X;const _=g("el-button"),k=g("el-col"),M=g("el-tooltip"),D=g("el-row"),U=g("el-alert"),u=g("el-radio"),d=g("el-radio-group"),B=g("el-form-item"),ve=g("el-form"),_e=g("el-checkbox"),K=g("el-dialog"),P=fe("loading");return c(),r("div",ye,[e[38]||(e[38]=s("div",{class:"page-title"},[s("h2",null,"系统监控"),s("p",{class:"page-subtitle"},"实时监控系统运行状态和资源使用情况")],-1)),y.value?(c(),r("div",he,[s("div",be,[s("div",{class:f(["status-icon",y.value.status])},[s("i",{class:f(ae(y.value.status))},null,2)],2),s("div",we,[s("h3",null,a(J(y.value.status)),1),s("p",null,"系统运行时间: "+a(y.value.uptime),1)])]),s("div",xe,[s("div",Ve,[e[8]||(e[8]=s("span",{class:"metric-label"},"版本",-1)),s("span",ke,a(y.value.version),1)]),s("div",Ce,[e[9]||(e[9]=s("span",{class:"metric-label"},"服务数",-1)),s("span",Te,a(((O=y.value.summary)==null?void 0:O.total_services)||0),1)]),s("div",Se,[e[10]||(e[10]=s("span",{class:"metric-label"},"健康服务",-1)),s("span",Re,a(((Q=y.value.summary)==null?void 0:Q.healthy_services)||0),1)])])])):b("",!0),o(D,{gutter:24,class:"main-content"},{default:n(()=>[o(k,{span:12},{default:n(()=>[s("div",$e,[s("div",Me,[e[11]||(e[11]=s("h3",null,"服务状态",-1)),o(_,{onClick:Y,loading:w.value,size:"small",type:"primary",icon:w.value?"":"Refresh",circle:""},null,8,["loading","icon"])]),F((c(),r("div",De,[(c(!0),r(E,null,L(N.value,t=>(c(),r("div",{class:"service-item",key:t.name},[s("div",Ue,[s("div",Ge,[s("i",{class:f([oe(t.name),"service-icon"])},null,2),i(" "+a(t.name),1)]),s("div",Ie,a(t.message),1)]),s("div",{class:f(["service-status",t.status])},[e[12]||(e[12]=s("span",{class:"status-dot"},null,-1)),i(" "+a(J(t.status)),1)],2)]))),128))])),[[P,w.value]])])]),_:1}),o(k,{span:12},{default:n(()=>[s("div",ze,[s("div",Be,[e[13]||(e[13]=s("h3",null,"系统资源",-1)),o(M,{content:"点击查看性能说明",placement:"top"},{default:n(()=>[o(_,{onClick:e[0]||(e[0]=t=>T.value=!T.value),size:"small",type:"info",icon:T.value?"Hide":"InfoFilled",circle:""},null,8,["icon"])]),_:1})]),T.value?(c(),r("div",Pe,e[14]||(e[14]=[s("div",{class:"info-header"},[s("i",{class:"el-icon-info-filled"}),i(" 性能指标说明 ")],-1),s("div",{class:"info-content"},[s("div",{class:"info-item"},[s("strong",null,"CPU核心数:"),i(" 系统处理能力上限，10核心可同时处理多个任务 ")]),s("div",{class:"info-item"},[s("strong",null,"内存使用:"),i(" 应用实际占用内存，<50%健康，50-80%需关注，>80%异常 ")]),s("div",{class:"info-item"},[s("strong",null,"Goroutine:"),i(" 并发任务数，<100正常，100-1000中等负载，>1000高负载 ")]),s("div",{class:"info-item"},[s("strong",null,"GC次数:"),i(" 垃圾回收频率，反映内存分配模式和程序运行时间 ")])],-1)]))):b("",!0),F((c(),r("div",Fe,[h.value.find(t=>t.type==="cpu")?(c(),r("div",Ee,[s("div",Le,[e[16]||(e[16]=s("div",{class:"cpu-icon"},[s("i",{class:"el-icon-monitor"})],-1)),s("div",Ne,[s("div",He,a(h.value.find(t=>t.type==="cpu").name),1),s("div",qe,[s("span",Ae,a(h.value.find(t=>t.type==="cpu").value),1),s("span",je,a(h.value.find(t=>t.type==="cpu").unit),1)]),s("div",Je,a(A(h.value.find(t=>t.type==="cpu"))),1)]),s("div",{class:f(["cpu-status",z(h.value.find(t=>t.type==="cpu"))])},[e[15]||(e[15]=s("i",{class:"el-icon-success-filled"},null,-1)),s("span",null,a(q(h.value.find(t=>t.type==="cpu"))),1)],2)])])):b("",!0),(c(!0),r(E,null,L(h.value.filter(t=>t.type!=="cpu"),t=>(c(),r("div",{class:"chart-item",key:t.name},[s("div",Ke,[s("div",Oe,[s("span",Qe,a(t.name),1),s("span",We,a(t.value)+a(t.unit),1)]),s("div",{class:f(["chart-status",z(t)])},a(q(t)),3)]),s("div",Xe,[s("div",{class:"progress-circle",style:ge({background:`conic-gradient(${ee(t.percentage)} ${t.percentage*3.6}deg, #f0f0f0 0deg)`})},[s("div",Ye,[s("div",Ze,a(t.percentage)+"%",1),s("div",es,a(se(t.name)),1)])],4)]),s("div",ss,[s("div",ts,a(A(t)),1),s("div",ls,a(te(t.name)),1)])]))),128))])),[[P,w.value]])])]),_:1})]),_:1}),s("div",as,[s("div",os,[e[17]||(e[17]=s("h3",null,"业务统计",-1)),o(_,{onClick:Z,loading:x.value,size:"small",type:"primary",icon:x.value?"":"Refresh",circle:""},null,8,["loading","icon"])]),F((c(),r("div",ns,[(c(!0),r(E,null,L(S.value,t=>(c(),r("div",{class:"stat-item",key:t.name},[s("div",is,[s("i",{class:f(ne(t.name))},null,2)]),s("div",rs,[s("div",cs,a(t.value),1),s("div",us,a(t.name),1),t.desc?(c(),r("div",ds,a(t.desc),1)):b("",!0)]),s("div",vs,[s("div",{class:f(["trend-indicator",j(t)])},[s("i",{class:f(le(t))},null,2)],2)])]))),128))])),[[P,x.value]])]),s("div",_s,[s("div",ms,[e[19]||(e[19]=s("h3",null,"历史数据清理",-1)),o(_,{onClick:e[1]||(e[1]=t=>V.value=!0),type:"danger",size:"small",icon:"Delete"},{default:n(()=>e[18]||(e[18]=[i(" 清理数据 ")])),_:1,__:[18]})]),s("div",ps,[e[22]||(e[22]=s("p",{class:"cleanup-desc"},"定期清理历史数据可以释放存储空间，提高系统性能。请根据需要选择清理范围。",-1)),s("div",fs,[s("div",gs,[e[20]||(e[20]=s("span",{class:"stat-label"},"告警记录总数:",-1)),s("span",ys,a(((W=S.value.find(t=>t.name==="告警记录"))==null?void 0:W.total)||0),1)]),s("div",hs,[e[21]||(e[21]=s("span",{class:"stat-label"},"通知记录总数:",-1)),s("span",bs,a(((X=S.value.find(t=>t.name==="通知记录"))==null?void 0:X.total)||0),1)])])])]),o(K,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),title:"历史数据清理",width:"500px","close-on-click-modal":!1},{footer:n(()=>[s("span",Ts,[o(_,{onClick:e[5]||(e[5]=t=>V.value=!1)},{default:n(()=>e[34]||(e[34]=[i("取消")])),_:1,__:[34]}),o(_,{type:"danger",onClick:ce,disabled:!v.value.confirmed,loading:$.value},{default:n(()=>[i(a($.value?"清理中...":"确认清理"),1)]),_:1},8,["disabled","loading"])])]),default:n(()=>[s("div",ws,[s("div",xs,[o(U,{title:"警告：数据清理操作不可逆",type:"warning",description:"清理后的数据将无法恢复，请谨慎操作。建议在清理前备份重要数据。","show-icon":"",closable:!1})]),o(ve,{model:v.value,"label-width":"100px",class:"cleanup-form"},{default:n(()=>[o(B,{label:"数据类型"},{default:n(()=>[o(d,{modelValue:v.value.dataType,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value.dataType=t)},{default:n(()=>[o(u,{value:"alerts"},{default:n(()=>e[23]||(e[23]=[i("仅告警历史")])),_:1,__:[23]}),o(u,{value:"notifications"},{default:n(()=>e[24]||(e[24]=[i("仅通知历史")])),_:1,__:[24]}),o(u,{value:"both"},{default:n(()=>e[25]||(e[25]=[i("告警和通知历史")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),o(B,{label:"时间范围"},{default:n(()=>[o(d,{modelValue:v.value.timeRange,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.timeRange=t)},{default:n(()=>[o(u,{value:"1month"},{default:n(()=>e[26]||(e[26]=[i("1个月前")])),_:1,__:[26]}),o(u,{value:"3months"},{default:n(()=>e[27]||(e[27]=[i("3个月前")])),_:1,__:[27]}),o(u,{value:"6months"},{default:n(()=>e[28]||(e[28]=[i("6个月前")])),_:1,__:[28]}),o(u,{value:"1year"},{default:n(()=>e[29]||(e[29]=[i("1年前")])),_:1,__:[29]}),o(u,{value:"2years"},{default:n(()=>e[30]||(e[30]=[i("2年前")])),_:1,__:[30]}),o(u,{value:"all"},{default:n(()=>e[31]||(e[31]=[i("全部数据")])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),o(B,{label:"清理预览"},{default:n(()=>[s("div",Vs,[s("p",null,[e[32]||(e[32]=i("将清理: ")),s("strong",null,a(ie()),1)]),s("p",ks,"清理范围: "+a(re()),1)])]),_:1})]),_:1},8,["model"]),s("div",Cs,[o(_e,{modelValue:v.value.confirmed,"onUpdate:modelValue":e[4]||(e[4]=t=>v.value.confirmed=t)},{default:n(()=>e[33]||(e[33]=[i(" 我确认已了解数据清理的风险，并同意执行此操作 ")])),_:1,__:[33]},8,["modelValue"])])])]),_:1},8,["modelValue"]),o(K,{modelValue:R.value,"onUpdate:modelValue":e[7]||(e[7]=t=>R.value=t),title:"清理结果",width:"400px","close-on-click-modal":!1},{footer:n(()=>[s("span",Us,[o(_,{type:"primary",onClick:ue},{default:n(()=>e[37]||(e[37]=[i("确定")])),_:1,__:[37]})])]),default:n(()=>[s("div",Ss,[s("div",{class:f(["result-icon",p.value.success?"success":"error"])},[s("i",{class:f(p.value.success?"el-icon-success-filled":"el-icon-error-filled")},null,2)],2),s("div",Rs,[s("h4",null,a(p.value.success?"清理完成":"清理失败"),1),p.value.success?(c(),r("p",$s,[e[35]||(e[35]=i(" 成功删除 ")),s("strong",null,a(p.value.deleted_rows),1),e[36]||(e[36]=i(" 条记录 "))])):b("",!0),p.value.success?(c(),r("p",Ms," 耗时: "+a(de(p.value.duration)),1)):b("",!0),p.value.success?b("",!0):(c(),r("p",Ds,a(p.value.error),1))])])]),_:1},8,["modelValue"])])}}},Ps=me(Gs,[["__scopeId","data-v-4331d8f2"]]);export{Ps as default};
//# sourceMappingURL=System-CPOBBTWj.js.map
