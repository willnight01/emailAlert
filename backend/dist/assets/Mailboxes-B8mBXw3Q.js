import{_ as ne,r as _,K as oe,g as r,L as K,o as T,w as t,e,d as k,h as m,l as $,M as be,E as c,N as we,n as ye,c as se,v as Ve,B as Ce,O as he,P as ke,q as xe,t as M,Q as ze,R as $e,J as Pe,S as qe,T as Me,G as Se,U as Ue}from"./index-Cq749T7a.js";import{m as S}from"./index-DZNyvenB.js";const Fe={class:"password-hint"},De={class:"quick-config-hint"},Ie={__name:"MailboxForm",props:{modelValue:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(g,{expose:D,emit:Q}){const P=g,I=Q,x=_(),o=_({name:"",email:"",protocol:"IMAP",host:"",port:993,username:"",password:"",ssl:!0,description:"",...P.modelValue}),q={name:[{required:!0,message:"请输入邮箱名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}],host:[{required:!0,message:"请输入服务器地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口号范围 1-65535",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f={gmail:{imap:{host:"imap.gmail.com",port:993,ssl:!0},pop3:{host:"pop.gmail.com",port:995,ssl:!0}},outlook:{imap:{host:"outlook.office365.com",port:993,ssl:!0},pop3:{host:"outlook.office365.com",port:995,ssl:!0}},qq:{imap:{host:"imap.qq.com",port:993,ssl:!0},pop3:{host:"pop.qq.com",port:995,ssl:!0}},163:{imap:{host:"imap.163.com",port:993,ssl:!0},pop3:{host:"pop.163.com",port:995,ssl:!0}}};oe(()=>P.modelValue,i=>{Object.assign(o.value,i)},{deep:!0,immediate:!0}),oe(o,i=>{I("update:modelValue",{...i})},{deep:!0});const C=async()=>{try{return await x.value.validate(),!0}catch{return!1}},z=()=>{var i;(i=x.value)==null||i.resetFields()},U=()=>{var i;(i=x.value)==null||i.clearValidate()},L=()=>{o.value.email&&!o.value.username&&(o.value.username=o.value.email)},B=()=>{o.value.host&&N()},y=()=>{N()},N=()=>{const i=o.value.host.toLowerCase(),s=o.value.protocol.toLowerCase(),v=o.value.ssl,w={imap:v?993:143,pop3:v?995:110};if(i.includes("gmail.com")){const p=f.gmail[s];p&&(o.value.port=p.port,o.value.ssl=p.ssl)}else if(i.includes("outlook.office365.com")||i.includes("hotmail.com")){const p=f.outlook[s];p&&(o.value.port=p.port,o.value.ssl=p.ssl)}else if(i.includes("qq.com")){const p=f.qq[s];p&&(o.value.port=p.port,o.value.ssl=p.ssl)}else if(i.includes("163.com")){const p=f[163][s];p&&(o.value.port=p.port,o.value.ssl=p.ssl)}else o.value.port=w[s]||993},V=i=>{const s=f[i];if(!s)return;const v=s[o.value.protocol.toLowerCase()];v&&(o.value.host=v.host,o.value.port=v.port,o.value.ssl=v.ssl,c.success(`已应用${i.toUpperCase()}配置`))};return D({validate:C,resetFields:z,clearValidate:U,formData:o}),(i,s)=>{const v=r("el-input"),w=r("el-form-item"),p=r("el-option"),J=r("el-select"),j=r("el-col"),H=r("el-input-number"),W=r("el-row"),X=r("el-icon"),R=r("el-text"),Y=r("el-switch"),A=r("el-button"),Z=r("el-button-group"),ee=r("el-form");return T(),K(ee,{ref_key:"formRef",ref:x,model:o.value,rules:q,"label-width":"100px","label-position":"left"},{default:t(()=>[e(w,{label:"邮箱名称",prop:"name"},{default:t(()=>[e(v,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=u=>o.value.name=u),placeholder:"请输入邮箱名称",disabled:g.loading},null,8,["modelValue","disabled"])]),_:1}),e(w,{label:"邮箱地址",prop:"email"},{default:t(()=>[e(v,{modelValue:o.value.email,"onUpdate:modelValue":s[1]||(s[1]=u=>o.value.email=u),placeholder:"请输入邮箱地址",disabled:g.loading,onBlur:L},null,8,["modelValue","disabled"])]),_:1}),e(w,{label:"协议类型",prop:"protocol"},{default:t(()=>[e(J,{modelValue:o.value.protocol,"onUpdate:modelValue":s[2]||(s[2]=u=>o.value.protocol=u),placeholder:"请选择协议类型",style:{width:"100%"},disabled:g.loading,onChange:B},{default:t(()=>[e(p,{label:"IMAP",value:"IMAP"}),e(p,{label:"POP3",value:"POP3"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(W,{gutter:20},{default:t(()=>[e(j,{span:14},{default:t(()=>[e(w,{label:"服务器地址",prop:"host"},{default:t(()=>[e(v,{modelValue:o.value.host,"onUpdate:modelValue":s[3]||(s[3]=u=>o.value.host=u),placeholder:"如: imap.gmail.com",disabled:g.loading,onBlur:N},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(j,{span:10},{default:t(()=>[e(w,{label:"端口",prop:"port"},{default:t(()=>[e(H,{modelValue:o.value.port,"onUpdate:modelValue":s[4]||(s[4]=u=>o.value.port=u),min:1,max:65535,style:{width:"100%"},placeholder:"端口号",disabled:g.loading,"controls-position":i.right,size:"default"},null,8,["modelValue","disabled","controls-position"])]),_:1})]),_:1})]),_:1}),e(w,{label:"用户名",prop:"username"},{default:t(()=>[e(v,{modelValue:o.value.username,"onUpdate:modelValue":s[5]||(s[5]=u=>o.value.username=u),placeholder:"通常为邮箱地址",disabled:g.loading},null,8,["modelValue","disabled"])]),_:1}),e(w,{label:"密码",prop:"password"},{default:t(()=>[e(v,{modelValue:o.value.password,"onUpdate:modelValue":s[6]||(s[6]=u=>o.value.password=u),type:"text",placeholder:"请输入密码或应用专用密码",disabled:g.loading},null,8,["modelValue","disabled"]),k("div",Fe,[e(R,{size:"small",type:"info"},{default:t(()=>[e(X,null,{default:t(()=>[e($(be))]),_:1}),s[13]||(s[13]=m(" 对于Gmail等邮箱，请使用应用专用密码而非登录密码 "))]),_:1,__:[13]})])]),_:1}),e(w,{label:"SSL加密"},{default:t(()=>[e(Y,{modelValue:o.value.ssl,"onUpdate:modelValue":s[7]||(s[7]=u=>o.value.ssl=u),"active-text":"启用","inactive-text":"禁用",disabled:g.loading,onChange:y},null,8,["modelValue","disabled"])]),_:1}),e(w,{label:"描述"},{default:t(()=>[e(v,{modelValue:o.value.description,"onUpdate:modelValue":s[8]||(s[8]=u=>o.value.description=u),type:"textarea",rows:3,placeholder:"邮箱配置描述（可选）",disabled:g.loading},null,8,["modelValue","disabled"])]),_:1}),e(w,{label:"快捷配置"},{default:t(()=>[e(Z,null,{default:t(()=>[e(A,{size:"small",onClick:s[9]||(s[9]=u=>V("gmail")),disabled:g.loading},{default:t(()=>s[14]||(s[14]=[m(" Gmail ")])),_:1,__:[14]},8,["disabled"]),e(A,{size:"small",onClick:s[10]||(s[10]=u=>V("outlook")),disabled:g.loading},{default:t(()=>s[15]||(s[15]=[m(" Outlook ")])),_:1,__:[15]},8,["disabled"]),e(A,{size:"small",onClick:s[11]||(s[11]=u=>V("qq")),disabled:g.loading},{default:t(()=>s[16]||(s[16]=[m(" QQ邮箱 ")])),_:1,__:[16]},8,["disabled"]),e(A,{size:"small",onClick:s[12]||(s[12]=u=>V("163")),disabled:g.loading},{default:t(()=>s[17]||(s[17]=[m(" 163邮箱 ")])),_:1,__:[17]},8,["disabled"])]),_:1}),k("div",De,[e(R,{size:"small",type:"info"},{default:t(()=>s[18]||(s[18]=[m("点击快捷配置按钮自动填充服务器配置")])),_:1,__:[18]})])]),_:1})]),_:1},8,["model"])}}},Le=ne(Ie,[["__scopeId","data-v-e97ff62e"]]),Be={class:"mailboxes"},Ae={class:"page-header"},Oe={class:"filter-section"},Ee={class:"name-cell"},Te={class:"name"},Ne={key:0,class:"description"},Re={class:"connection-status"},Qe={class:"pagination-wrapper"},je={class:"dialog-footer"},Ge={__name:"Mailboxes",setup(g){const D=_(!1),Q=_([]),P=_(""),I=_(""),x=_(""),o=_([]),q=_({}),f=_({page:1,size:20,total:0}),C=_(!1),z=_(!1),U=_(),L=_(!1),B=_(!1),y=_({name:"",email:"",protocol:"IMAP",host:"",port:993,username:"",password:"",ssl:!0,description:""}),N=we(()=>Q.value.filter(a=>{const l=P.value===""||a.name.toLowerCase().includes(P.value.toLowerCase())||a.email.toLowerCase().includes(P.value.toLowerCase()),b=I.value===""||a.status===I.value,d=x.value===""||a.protocol===x.value;return l&&b&&d}));ye(()=>{V()});const V=async()=>{D.value=!0;try{const a={page:f.value.page,size:f.value.size},l=await S.list(a);Q.value=l.data.list||[],f.value.total=l.data.total||0}catch(a){console.error("加载邮箱列表失败:",a),c.error("加载邮箱列表失败")}finally{D.value=!1}},i=()=>{V()},s=()=>{},v=()=>{},w=a=>{f.value.size=a,f.value.page=1,V()},p=a=>{f.value.page=a,V()},J=()=>{z.value=!1,H(),C.value=!0},j=async a=>{z.value=!0;try{const l=await S.getForEdit(a.id);y.value={...l.data},C.value=!0}catch(l){console.error("获取邮箱详情失败:",l),c.error("获取邮箱详情失败"),y.value={...a},y.value.password="",C.value=!0}},H=()=>{y.value={name:"",email:"",protocol:"IMAP",host:"",port:993,username:"",password:"",ssl:!0,description:""},U.value&&U.value.resetFields()},W=async()=>{var a,l;try{if(!await U.value.validate()){c.error("请先填写完整的邮箱配置信息");return}L.value=!0;const d={...y.value,username:y.value.email},F=await S.test(d);if(F.data&&F.data.status==="connected")c.success("连接测试成功！");else{const O=((a=F.data)==null?void 0:a.message)||"连接测试失败";c.error(`连接测试失败: ${O}`)}}catch(b){b.response?c.error(`连接测试失败: ${((l=b.response.data)==null?void 0:l.message)||"未知错误"}`):c.error("连接测试失败，请检查配置信息")}finally{L.value=!1}},X=async()=>{try{if(!await U.value.validate())return;B.value=!0;const l={...y.value,username:y.value.email};z.value?(l.password||delete l.password,await S.update(l.id,l),c.success("邮箱配置更新成功")):(await S.create(l),c.success("邮箱配置创建成功")),C.value=!1,V()}catch{c.error(z.value?"更新邮箱配置失败":"创建邮箱配置失败")}finally{B.value=!1}},R=async a=>{var l,b;if(!o.value.includes(a.id)){o.value.push(a.id);try{const d=await S.test(a.id);if(d.data&&d.data.status==="connected")q.value[a.id]="success",c.success(`${a.name} 连接测试成功`);else{const F=((l=d.data)==null?void 0:l.message)||"连接失败";q.value[a.id]="error",c.error(`${a.name} 连接测试失败: ${F}`)}}catch(d){q.value[a.id]="error",d.response?c.error(`${a.name} 连接测试失败: ${((b=d.response.data)==null?void 0:b.message)||"连接失败"}`):c.error(`${a.name} 连接测试失败，请检查配置信息`)}finally{o.value=o.value.filter(d=>d!==a.id),setTimeout(()=>{delete q.value[a.id]},3e3)}}},Y=async a=>{try{const l=a.status==="active"?"inactive":"active";await S.update(a.id,{status:l}),a.status=l,c.success(`邮箱已${l==="active"?"启用":"停用"}`)}catch{c.error("状态更新失败")}},A=async(a,l)=>{switch(a){case"test":await R(l);break;case"duplicate":await Z(l);break;case"delete":await ee(l);break}},Z=async a=>{try{const l={name:`${a.name} - 副本`,email:a.email,protocol:a.protocol,host:a.host,port:a.port,username:a.username,password:"",ssl:a.ssl,status:"inactive",description:`${a.description||""} (复制自 ${a.name})`};z.value=!1,y.value=l,C.value=!0,c.info("请设置新邮箱的密码")}catch(l){console.error("复制邮箱失败:",l),c.error("复制邮箱失败")}},ee=async a=>{try{await Ue.confirm(`确定要删除邮箱 "${a.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await S.delete(a.id),c.success("邮箱删除成功"),V()}catch(l){l!=="cancel"&&c.error("删除邮箱失败")}},u=a=>{const l=q.value[a];return l==="success"?"success":l==="error"?"danger":"primary"},re=a=>{const l=q.value[a];return l==="success"?"连接正常":l==="error"?"连接失败":"测试连接"},ie=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return(a,l)=>{const b=r("el-icon"),d=r("el-button"),F=r("el-input"),O=r("el-col"),E=r("el-option"),te=r("el-select"),ue=r("el-row"),h=r("el-table-column"),ae=r("el-tag"),le=r("el-dropdown-item"),de=r("el-dropdown-menu"),ce=r("el-dropdown"),me=r("el-button-group"),pe=r("el-table"),fe=r("el-pagination"),ve=r("el-card"),_e=r("el-dialog"),ge=Ve("loading");return T(),se("div",Be,[e(ve,null,{header:t(()=>[k("div",Ae,[l[9]||(l[9]=k("span",null,"邮箱管理",-1)),e(d,{type:"primary",onClick:J},{default:t(()=>[e(b,null,{default:t(()=>[e($(Se))]),_:1}),l[8]||(l[8]=m(" 添加邮箱 "))]),_:1,__:[8]})])]),default:t(()=>[k("div",Oe,[e(ue,{gutter:20},{default:t(()=>[e(O,{span:8},{default:t(()=>[e(F,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=n=>P.value=n),placeholder:"搜索邮箱名称或地址",clearable:"",onInput:s},{prefix:t(()=>[e(b,null,{default:t(()=>[e($(he))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(O,{span:6},{default:t(()=>[e(te,{modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=n=>I.value=n),placeholder:"状态筛选",clearable:"",onChange:v},{default:t(()=>[e(E,{label:"全部状态",value:""}),e(E,{label:"激活",value:"active"}),e(E,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),e(O,{span:6},{default:t(()=>[e(te,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=n=>x.value=n),placeholder:"协议筛选",clearable:"",onChange:v},{default:t(()=>[e(E,{label:"全部协议",value:""}),e(E,{label:"IMAP",value:"IMAP"}),e(E,{label:"POP3",value:"POP3"})]),_:1},8,["modelValue"])]),_:1}),e(O,{span:4},{default:t(()=>[e(d,{onClick:i,loading:D.value},{default:t(()=>[e(b,null,{default:t(()=>[e($(ke))]),_:1}),l[10]||(l[10]=m(" 刷新 "))]),_:1,__:[10]},8,["loading"])]),_:1})]),_:1})]),Ce((T(),K(pe,{data:N.value,style:{width:"100%"},"default-sort":{prop:"created_at",order:"descending"}},{default:t(()=>[e(h,{prop:"name",label:"邮箱名称","min-width":"150"},{default:t(n=>[k("div",Ee,[k("span",Te,M(n.row.name),1),n.row.description?(T(),se("span",Ne,M(n.row.description),1)):xe("",!0)])]),_:1}),e(h,{prop:"email",label:"邮箱地址","min-width":"200"}),e(h,{prop:"protocol",label:"协议",width:"80"},{default:t(n=>[e(ae,{size:"small",type:n.row.protocol==="IMAP"?"primary":"success"},{default:t(()=>[m(M(n.row.protocol),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"host",label:"服务器",width:"120"}),e(h,{prop:"port",label:"端口",width:"80"}),e(h,{label:"SSL",width:"60"},{default:t(n=>[n.row.ssl?(T(),K(b,{key:0,class:"ssl-icon",color:"#67c23a"},{default:t(()=>[e($(ze))]),_:1})):(T(),K(b,{key:1,color:"#f56c6c"},{default:t(()=>[e($($e))]),_:1}))]),_:1}),e(h,{prop:"status",label:"状态",width:"100"},{default:t(n=>[e(ae,{type:n.row.status==="active"?"success":"danger",size:"small"},{default:t(()=>[m(M(n.row.status==="active"?"激活":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(h,{label:"连接状态",width:"120"},{default:t(n=>[k("div",Re,[e(d,{type:u(n.row.id),size:"small",loading:o.value.includes(n.row.id),onClick:G=>R(n.row)},{default:t(()=>[m(M(re(n.row.id)),1)]),_:2},1032,["type","loading","onClick"])])]),_:1}),e(h,{prop:"created_at",label:"创建时间",width:"160"},{default:t(n=>[m(M(ie(n.row.created_at)),1)]),_:1}),e(h,{label:"操作",width:"250",fixed:"right"},{default:t(n=>[e(me,null,{default:t(()=>[e(d,{type:"primary",size:"small",onClick:G=>j(n.row),icon:$(Pe)},{default:t(()=>l[11]||(l[11]=[m(" 编辑 ")])),_:2,__:[11]},1032,["onClick","icon"]),e(d,{type:n.row.status==="active"?"warning":"success",size:"small",onClick:G=>Y(n.row),icon:$(qe)},{default:t(()=>[m(M(n.row.status==="active"?"停用":"启用"),1)]),_:2},1032,["type","onClick","icon"]),e(ce,{onCommand:G=>A(G,n.row)},{dropdown:t(()=>[e(de,null,{default:t(()=>[e(le,{command:"test"},{default:t(()=>l[13]||(l[13]=[m(" 测试连接 ")])),_:1,__:[13]}),e(le,{command:"duplicate"},{default:t(()=>l[14]||(l[14]=[m(" 复制邮箱 ")])),_:1,__:[14]}),e(le,{command:"delete",class:"text-danger",divided:""},{default:t(()=>l[15]||(l[15]=[m(" 删除 ")])),_:1,__:[15]})]),_:1})]),default:t(()=>[e(d,{size:"small",type:"info"},{default:t(()=>[l[12]||(l[12]=m(" 更多")),e(b,{class:"el-icon--right"},{default:t(()=>[e($(Me))]),_:1})]),_:1,__:[12]})]),_:2},1032,["onCommand"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ge,D.value]]),k("div",Qe,[e(fe,{"current-page":f.value.page,"onUpdate:currentPage":l[3]||(l[3]=n=>f.value.page=n),"page-size":f.value.size,"onUpdate:pageSize":l[4]||(l[4]=n=>f.value.size=n),"page-sizes":[10,20,50,100],total:f.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:p},null,8,["current-page","page-size","total"])])]),_:1}),e(_e,{modelValue:C.value,"onUpdate:modelValue":l[7]||(l[7]=n=>C.value=n),title:z.value?"编辑邮箱":"添加邮箱",width:"600px","close-on-click-modal":!1},{footer:t(()=>[k("div",je,[e(d,{onClick:l[6]||(l[6]=n=>C.value=!1)},{default:t(()=>l[16]||(l[16]=[m("取消")])),_:1,__:[16]}),e(d,{type:"info",onClick:W,loading:L.value},{default:t(()=>l[17]||(l[17]=[m(" 测试连接 ")])),_:1,__:[17]},8,["loading"]),e(d,{type:"primary",onClick:X,loading:B.value},{default:t(()=>[m(M(z.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:t(()=>[e(Le,{ref_key:"mailboxFormRef",ref:U,modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=n=>y.value=n),loading:L.value||B.value},null,8,["modelValue","loading"])]),_:1},8,["modelValue","title"])])}}},He=ne(Ge,[["__scopeId","data-v-3429c3ee"]]);export{He as default};
//# sourceMappingURL=Mailboxes-B8mBXw3Q.js.map
