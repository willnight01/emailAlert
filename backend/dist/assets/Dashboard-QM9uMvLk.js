import{_ as as,r as k,n as ls,p as ns,E as os,c as m,o as p,d as s,q as is,e,w as n,g as C,s as z,t as o,i as rs,v as ds,h as c,l as x,x as cs,y as us,z as vs,A as _s,B as A,F as H,C as j,D as fs,G as ms,H as ps,I as gs,J as ys}from"./index-Cq749T7a.js";import{s as I,b as bs}from"./index-DZNyvenB.js";const ws={class:"dashboard-page"},hs={class:"page-title"},ks={class:"title-actions"},xs={key:0,class:"status-overview"},Cs={class:"overall-status"},Ss={class:"status-info"},$s={class:"system-metrics"},zs={class:"metric-item"},Ts={class:"metric-value"},Ms={class:"metric-item"},Ds={class:"metric-value"},As={class:"metric-item"},Is={class:"metric-value text-success"},Vs={class:"stat-icon-wrapper"},Ps={class:"stat-content"},Ns={class:"stat-value"},Bs={class:"stat-desc"},qs={class:"stat-icon-wrapper"},Es={class:"stat-content"},Gs={class:"stat-value"},Rs={class:"stat-desc"},Us={class:"stat-icon-wrapper"},Fs={class:"stat-content"},Hs={class:"stat-value"},js={class:"stat-desc"},Js={class:"stat-icon-wrapper"},Os={class:"stat-content"},Ks={class:"stat-value"},Ls={class:"stat-desc"},Qs={class:"content-card"},Ws={class:"card-header"},Xs={class:"service-list"},Ys={class:"service-info"},Zs={class:"service-name"},st={class:"service-desc"},tt={class:"content-card"},et={class:"card-header"},at={class:"resource-metrics"},lt={class:"metric-grid"},nt={class:"metric-header"},ot={class:"metric-name"},it={class:"metric-value"},rt={class:"metric-progress"},dt={class:"progress-center"},ct={class:"progress-percentage"},ut={class:"content-card"},vt={class:"quick-actions"},_t={class:"content-card"},ft={class:"card-header"},mt={class:"header-actions"},pt={class:"alerts-table"},gt={class:"content-card"},yt={class:"performance-overview"},bt={class:"perf-item"},wt={class:"perf-value"},ht={class:"perf-item"},kt={class:"perf-value"},xt={class:"perf-desc"},Ct={class:"perf-item"},St={class:"perf-value"},$t={class:"perf-item"},zt={class:"perf-value"},Tt={__name:"Dashboard",setup(Mt){const N=rs(),h=k(!1),T=k(!1),g=k(null),B=k([]),$=k({}),q=k([]),f=k({}),M=k([]);let V=null;ls(()=>{P(),V=setInterval(()=>{P(!1)},3e4)}),ns(()=>{V&&clearInterval(V)});const P=async(l=!0)=>{var t,i,v,d,S,y,D;l&&(h.value=!0);try{const[_,b]=await Promise.all([I.health().catch(()=>null),I.stats().catch(()=>null)]);if(_!=null&&_.data){g.value=_.data,B.value=_.data.services||[],$.value=_.data.resources||{};const r=_.data.resources;r&&(q.value=[{name:"CPU核心数",value:((t=r.cpu)==null?void 0:t.cores)||0,unit:"个",percentage:Math.min((((i=r.cpu)==null?void 0:i.cores)||0)*10,100),type:"cpu"},{name:"内存使用",value:G(((v=r.memory)==null?void 0:v.alloc)||0),unit:"",percentage:Math.round(((d=r.memory)==null?void 0:d.usage_percent)||0),type:"memory",rawValue:((S=r.memory)==null?void 0:S.alloc)||0},{name:"Goroutine数",value:r.goroutines||0,unit:"个",percentage:Math.min((r.goroutines||0)*2,100),type:"goroutine",rawValue:r.goroutines||0},{name:"GC次数",value:((y=r.gc)==null?void 0:y.num_gc)||0,unit:"次",percentage:Math.min((((D=r.gc)==null?void 0:D.num_gc)||0)*5,100),type:"gc"}])}b!=null&&b.data&&(f.value=b.data.business||{}),await E(!1)}catch(_){console.error("加载仪表盘数据失败:",_),l&&os.error("加载数据失败")}finally{l&&(h.value=!1)}},E=async(l=!0)=>{var t;l&&(T.value=!0);try{const i=await bs.list({page:1,size:10,sort_by:"created_at",sort_order:"desc"});(t=i==null?void 0:i.data)!=null&&t.alerts?M.value=i.data.alerts:M.value=[]}catch(i){console.error("加载最近告警失败:",i),M.value=[]}finally{l&&(T.value=!1)}},J=()=>{P(!0)},O=()=>{E(!0)},u=(l,t={})=>{N.push({path:l,query:t})},K=l=>{N.push(`/alerts?id=${l.id}`)},L=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",G=l=>I.formatMemorySize(l),Q=l=>({healthy:"el-icon-success-filled",degraded:"el-icon-warning-filled",unhealthy:"el-icon-error-filled"})[l]||"el-icon-info-filled",W=l=>({healthy:"系统运行正常",degraded:"系统运行降级",unhealthy:"系统运行异常"})[l]||"系统状态未知",X=l=>({数据库连接:"el-icon-coin",邮件监控服务:"el-icon-message",通知服务:"el-icon-bell",缓存服务:"el-icon-files"})[l]||"el-icon-service",Y=l=>I.getStatusText(l),Z=l=>l<50?"#52c41a":l<80?"#faad14":"#ff4d4f",R=l=>{switch(l.type){case"memory":return l.percentage<50?"excellent":l.percentage<80?"good":"warning";case"goroutine":return l.rawValue<50?"excellent":l.rawValue<100?"good":"warning";case"cpu":return"info";case"gc":return"info";default:return"info"}},ss=l=>{const t=R(l);return{excellent:"优秀",good:"良好",warning:"需关注",info:"正常"}[t]||"正常"},ts=l=>({pending:"warning",sent:"success",failed:"danger",cancelled:"info"})[l]||"info",es=l=>({pending:"待处理",sent:"已发送",failed:"失败",cancelled:"已取消"})[l]||"未知";return(l,t)=>{var r,U;const i=C("el-button"),v=C("el-icon"),d=C("el-col"),S=C("el-row"),y=C("el-table-column"),D=C("el-tag"),_=C("el-table"),b=ds("loading");return p(),m("div",ws,[s("div",hs,[t[11]||(t[11]=s("h2",null,"仪表盘",-1)),t[12]||(t[12]=s("p",{class:"page-subtitle"},"统一邮件告警平台运行概览",-1)),s("div",ks,[e(i,{onClick:J,loading:h.value,type:"primary",size:"small",icon:h.value?"":"Refresh"},{default:n(()=>[c(o(h.value?"刷新中...":"刷新数据"),1)]),_:1},8,["loading","icon"])])]),g.value?(p(),m("div",xs,[s("div",Cs,[s("div",{class:z(["status-icon",g.value.status])},[s("i",{class:z(Q(g.value.status))},null,2)],2),s("div",Ss,[s("h3",null,o(W(g.value.status)),1),s("p",null,"系统运行时间: "+o(g.value.uptime||"未知"),1)])]),s("div",$s,[s("div",zs,[t[13]||(t[13]=s("span",{class:"metric-label"},"版本",-1)),s("span",Ts,o(g.value.version||"v1.0.0"),1)]),s("div",Ms,[t[14]||(t[14]=s("span",{class:"metric-label"},"服务数",-1)),s("span",Ds,o(((r=g.value.summary)==null?void 0:r.total_services)||0),1)]),s("div",As,[t[15]||(t[15]=s("span",{class:"metric-label"},"健康服务",-1)),s("span",Is,o(((U=g.value.summary)==null?void 0:U.healthy_services)||0),1)])])])):is("",!0),e(S,{gutter:24,class:"stats-cards"},{default:n(()=>[e(d,{span:6},{default:n(()=>[s("div",{class:"stat-card",onClick:t[0]||(t[0]=a=>u("/mailboxes"))},[s("div",Vs,[e(v,{class:"stat-icon primary"},{default:n(()=>[e(x(cs))]),_:1})]),s("div",Ps,[s("div",Ns,o(f.value.total_mailboxes||0),1),t[16]||(t[16]=s("div",{class:"stat-label"},"邮箱总数",-1)),s("div",Bs,"活跃: "+o(f.value.active_mailboxes||0),1)]),t[17]||(t[17]=s("div",{class:"stat-trend"},[s("i",{class:"el-icon-right"})],-1))])]),_:1}),e(d,{span:6},{default:n(()=>[s("div",{class:"stat-card",onClick:t[1]||(t[1]=a=>u("/rule-groups"))},[s("div",qs,[e(v,{class:"stat-icon warning"},{default:n(()=>[e(x(us))]),_:1})]),s("div",Es,[s("div",Gs,o(f.value.total_rules||0),1),t[18]||(t[18]=s("div",{class:"stat-label"},"告警规则",-1)),s("div",Rs,"活跃: "+o(f.value.active_rules||0),1)]),t[19]||(t[19]=s("div",{class:"stat-trend"},[s("i",{class:"el-icon-right"})],-1))])]),_:1}),e(d,{span:6},{default:n(()=>[s("div",{class:"stat-card",onClick:t[2]||(t[2]=a=>u("/channels"))},[s("div",Us,[e(v,{class:"stat-icon info"},{default:n(()=>[e(x(vs))]),_:1})]),s("div",Fs,[s("div",Hs,o(f.value.total_channels||0),1),t[20]||(t[20]=s("div",{class:"stat-label"},"通知渠道",-1)),s("div",js,"活跃: "+o(f.value.active_channels||0),1)]),t[21]||(t[21]=s("div",{class:"stat-trend"},[s("i",{class:"el-icon-right"})],-1))])]),_:1}),e(d,{span:6},{default:n(()=>[s("div",{class:"stat-card",onClick:t[3]||(t[3]=a=>u("/alerts"))},[s("div",Js,[e(v,{class:"stat-icon success"},{default:n(()=>[e(x(_s))]),_:1})]),s("div",Os,[s("div",Ks,o(f.value.total_alerts||0),1),t[22]||(t[22]=s("div",{class:"stat-label"},"告警记录",-1)),s("div",Ls,"今日: "+o(f.value.today_alerts||0),1)]),t[23]||(t[23]=s("div",{class:"stat-trend"},[s("i",{class:"el-icon-right"})],-1))])]),_:1})]),_:1}),e(S,{gutter:24,class:"main-content"},{default:n(()=>[e(d,{span:8},{default:n(()=>[s("div",Qs,[s("div",Ws,[t[25]||(t[25]=s("h3",null,"系统服务",-1)),e(i,{onClick:t[4]||(t[4]=a=>u("/system")),size:"small",type:"primary",link:""},{default:n(()=>t[24]||(t[24]=[c(" 查看详情 ")])),_:1,__:[24]})]),A((p(),m("div",Xs,[(p(!0),m(H,null,j(B.value,a=>(p(),m("div",{class:"service-item",key:a.name},[s("div",Ys,[s("div",Zs,[s("i",{class:z([X(a.name),"service-icon"])},null,2),c(" "+o(a.name),1)]),s("div",st,o(a.message),1)]),s("div",{class:z(["service-status",a.status])},[t[26]||(t[26]=s("span",{class:"status-dot"},null,-1)),c(" "+o(Y(a.status)),1)],2)]))),128))])),[[b,h.value]])])]),_:1}),e(d,{span:8},{default:n(()=>[s("div",tt,[s("div",et,[t[28]||(t[28]=s("h3",null,"系统资源",-1)),e(i,{onClick:t[5]||(t[5]=a=>u("/system")),size:"small",type:"primary",link:""},{default:n(()=>t[27]||(t[27]=[c(" 查看详情 ")])),_:1,__:[27]})]),A((p(),m("div",at,[s("div",lt,[(p(!0),m(H,null,j(q.value,a=>(p(),m("div",{class:"metric-item",key:a.name},[s("div",nt,[s("span",ot,o(a.name),1),s("span",it,o(a.value)+o(a.unit),1)]),s("div",rt,[s("div",{class:"progress-circle",style:fs({background:`conic-gradient(${Z(a.percentage)} ${a.percentage*3.6}deg, #f0f0f0 0deg)`})},[s("div",dt,[s("div",ct,o(a.percentage)+"%",1)])],4)]),s("div",{class:z(["metric-status",R(a)])},o(ss(a)),3)]))),128))])])),[[b,h.value]])])]),_:1}),e(d,{span:8},{default:n(()=>[s("div",ut,[t[33]||(t[33]=s("div",{class:"card-header"},[s("h3",null,"快捷操作")],-1)),s("div",vt,[s("div",{class:"action-item",onClick:t[6]||(t[6]=a=>u("/mailboxes",{action:"create"}))},[e(v,{class:"action-icon"},{default:n(()=>[e(x(ms))]),_:1}),t[29]||(t[29]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"添加邮箱"),s("div",{class:"action-desc"},"配置新的邮箱监控")],-1))]),s("div",{class:"action-item",onClick:t[7]||(t[7]=a=>u("/rule-groups",{action:"create"}))},[e(v,{class:"action-icon"},{default:n(()=>[e(x(ps))]),_:1}),t[30]||(t[30]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"创建规则"),s("div",{class:"action-desc"},"添加告警匹配规则")],-1))]),s("div",{class:"action-item",onClick:t[8]||(t[8]=a=>u("/channels",{action:"create"}))},[e(v,{class:"action-icon"},{default:n(()=>[e(x(gs))]),_:1}),t[31]||(t[31]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"配置渠道"),s("div",{class:"action-desc"},"设置通知推送渠道")],-1))]),s("div",{class:"action-item",onClick:t[9]||(t[9]=a=>u("/templates",{action:"create"}))},[e(v,{class:"action-icon"},{default:n(()=>[e(x(ys))]),_:1}),t[32]||(t[32]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"编辑模版"),s("div",{class:"action-desc"},"自定义消息模版")],-1))])])])]),_:1})]),_:1}),e(S,{gutter:24,class:"bottom-content"},{default:n(()=>[e(d,{span:16},{default:n(()=>[s("div",_t,[s("div",ft,[t[36]||(t[36]=s("h3",null,"最近告警",-1)),s("div",mt,[e(i,{onClick:O,loading:T.value,size:"small",type:"primary",link:""},{default:n(()=>t[34]||(t[34]=[c(" 刷新 ")])),_:1,__:[34]},8,["loading"]),e(i,{onClick:t[10]||(t[10]=a=>u("/alerts")),size:"small",type:"primary",link:""},{default:n(()=>t[35]||(t[35]=[c(" 查看全部 ")])),_:1,__:[35]})])]),A((p(),m("div",pt,[e(_,{data:M.value,style:{width:"100%"},"empty-text":"暂无告警记录"},{default:n(()=>[e(y,{prop:"created_at",label:"时间",width:"160"},{default:n(a=>[c(o(L(a.row.created_at)),1)]),_:1}),e(y,{label:"邮箱源",width:"140"},{default:n(a=>{var w;return[c(o(((w=a.row.mailbox)==null?void 0:w.name)||"未知邮箱"),1)]}),_:1}),e(y,{prop:"subject",label:"主题","min-width":"200","show-overflow-tooltip":""}),e(y,{label:"规则",width:"120","show-overflow-tooltip":""},{default:n(a=>{var w;return[c(o(((w=a.row.rule_group)==null?void 0:w.name)||"无规则"),1)]}),_:1}),e(y,{prop:"status",label:"状态",width:"100"},{default:n(a=>[e(D,{type:ts(a.row.status),size:"small"},{default:n(()=>[c(o(es(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"操作",width:"80"},{default:n(a=>[e(i,{onClick:w=>K(a.row),size:"small",type:"primary",link:""},{default:n(()=>t[37]||(t[37]=[c(" 详情 ")])),_:2,__:[37]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])),[[b,T.value]])])]),_:1}),e(d,{span:8},{default:n(()=>{var a,w,F;return[s("div",gt,[t[45]||(t[45]=s("div",{class:"card-header"},[s("h3",null,"性能概览")],-1)),A((p(),m("div",yt,[s("div",bt,[t[38]||(t[38]=s("div",{class:"perf-label"},"CPU核心",-1)),s("div",wt,o(((a=$.value.cpu)==null?void 0:a.cores)||0)+" 核心",1),t[39]||(t[39]=s("div",{class:"perf-desc"},"处理能力充足",-1))]),s("div",ht,[t[40]||(t[40]=s("div",{class:"perf-label"},"内存使用",-1)),s("div",kt,o(G(((w=$.value.memory)==null?void 0:w.alloc)||0)),1),s("div",xt,"使用率: "+o(((F=$.value.memory)==null?void 0:F.usage_percent)||0)+"%",1)]),s("div",Ct,[t[41]||(t[41]=s("div",{class:"perf-label"},"并发数",-1)),s("div",St,o($.value.goroutines||0)+" 个",1),t[42]||(t[42]=s("div",{class:"perf-desc"},"系统负载轻",-1))]),s("div",$t,[t[43]||(t[43]=s("div",{class:"perf-label"},"成功率",-1)),s("div",zt,o(f.value.success_rate||0)+"%",1),t[44]||(t[44]=s("div",{class:"perf-desc"},"运行稳定",-1))])])),[[b,h.value]])])]}),_:1})]),_:1})])}}},It=as(Tt,[["__scopeId","data-v-2aef2ce8"]]);export{It as default};
//# sourceMappingURL=Dashboard-QM9uMvLk.js.map
